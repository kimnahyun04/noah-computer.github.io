<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<title>Noah Rhythm Game</title>
<link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2107@1.0/DungGeunMo.css" rel="stylesheet">

<style>
html, body {
  margin: 0;
  width: 100vw;
  height: 100vh;
  background: #000;
  overflow: hidden;
  image-rendering: pixelated;
}

/* ============================
   16:9 ê³ ì • ê²Œì„ í™”ë©´
============================ */
.game-container {
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.game-area {
  position: relative;
  width: calc(100vh * (16 / 9));
  height: 100vh;
  max-width: 100vw;
  max-height: calc(100vw * (9 / 16));
  overflow: hidden;
  background: #0b0f1a;
}

/* ë°°ê²½ */
.background {
  position: absolute;
  width: 100%;
  height: 100%;
  object-fit: cover;
  top: 0;
  left: 0;
  z-index: 1;
}

/* ëˆˆ */
.eye-wrapper {
  position: absolute;
  top: 0.5%;
  left: 0;
  width: 100%;
  pointer-events: none;
  z-index: 3;
}
.eye {
  width: 100%;
  transition: transform 0.05s linear;
}

/* ìŒì•…í”Œë ˆì´ì–´ íŒì—… */
#wmpPopup {
  position: absolute;
  top: 8vh;
  left: 50%;
  transform: translateX(-50%);
  display: block;
  z-index: 1000;
}

.player-img {
  max-width: 70vw;
  max-height: 70vh;
  display: block;
}

/* ë¦¬ë“¬ê²Œì„ PNG */
#rhythmGame {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;
  z-index: 1500;
  pointer-events: none;
}

/* ìºë¦­í„° */
#rhythmChar {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  z-index: 1600;
  pointer-events: none;
}

/* ============================
   ğŸ”º í™”ì‚´í‘œ ë ˆì¸
============================ */
#arrowLane {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 30000;
  pointer-events: none;
}

/* ì˜¬ë¼ì˜¤ëŠ” í™”ì‚´í‘œ */
.game-arrow {
  position: absolute;
  width: 100%;
  bottom: -20%;
}

/* íŒì • PNG ì ìš© */
.judge-effect {
  opacity: 1;
}

/* ============================
   â–¶ PLAY ë²„íŠ¼
============================ */
#startButton {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translateX(-50%);

  padding: 1.2vh 3vw;
  font-family: "DungGeunMo";
  font-size: 2.6vh;

  color: #ffefef;
  background: #b30000;
  border: 3px solid #ff4d4d;
  cursor: pointer;
  image-rendering: pixelated;
  z-index: 50000;

  box-shadow:
    inset -3px -3px 0 #660000,
    inset 3px 3px 0 #ff9999,
    3px 3px 0 #000;
}

/* hover ë™ì¼ */
#startButton:hover {
  background: #ff1a1a;
  border: 3px solid #ff8080;
}


/* ì¬ìƒ ì»¨íŠ¸ë¡¤ */
.controls {
  display: flex;
  gap: 1vw;
  position: absolute;
  left: 50%;
  bottom: 5%;
  transform: translateX(-50%);
}
.ctrl-btn {
  width: 3vw;
  height: 3vw;
  background: #797979;
  border: 2px solid #bbb;
  color: #fff;
  font-family: 'DungGeunMo', sans-serif;
  font-size: 1.6vh;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  image-rendering: pixelated;
  box-shadow:
    inset 2px 2px 0 #dcdcdc,
    inset -2px -2px 0 #505050,
    2px 2px 0 #000;
}

/* ============================
   ì„±ê³µ / ì‹¤íŒ¨ íŒì—… ìŠ¤íƒ€ì¼
============================ */
.popup {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 40vw;
  padding: 3vh 2vw;
  background: #1a1a1a;
  border: 5px solid #ff4d4d;
  text-align: center;
  font-family: "DungGeunMo";
  color: white;
  font-size: 3vh;
  display: none;
  z-index: 999999;
  image-rendering: pixelated;
}

.popup button {
  margin-top: 2vh;
  padding: 1vh 2vw;
  font-family: "DungGeunMo";
  background: #b30000;
  border: 3px solid #ff8080;
  color: white;
  font-size: 2.5vh;
  cursor: pointer;
}
/* ===========================
   ğŸˆ Music Virusì™€ ë™ì¼ ë§í’ì„ 
=========================== */
.speech-box {
  position: absolute;
  top: 59%;   /* â† ì´ê±¸ë¡œ ë°”ê¾¸ë©´ ìº¡ì²˜ ìœ„ì¹˜ì™€ 1í”½ì…€ ë‹¨ìœ„ë¡œ ì¼ì¹˜í•¨ */
  left: 50%;
  transform: translateX(-50%);
  padding: 1.5vh 2vw;
  background: #000;
  border: 3px solid white;
  image-rendering: pixelated;
  font-family: 'DungGeunMo';
  font-size: 2.2vh;
  color: white;
  z-index: 999999;
  display: none;
  max-width: 70%;
  text-align: center;
  box-shadow:
    inset -3px -3px 0 #555,
    inset 3px 3px 0 #aaa;
}
/* ê³µí†µ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
.icon {
  position: absolute;
  width: 7%;
  filter: drop-shadow(-0.4vw -0.4vh 0 #131313);
  cursor: pointer;
  z-index: 5;
  transition: transform 0.2s ease, opacity 0.2s ease;
}

/* ğŸ¯ í˜¸ë²„ ìŠ¤íƒ€ì¼ â€” Music Virusë‘ ë˜‘ê°™ìŒ */
.icon:hover {
  transform: scale(0.9);
}

.trash { top: 46%; left: 6%; }
.music-icon { top: 72%; left: 6%; }



</style>
</head>

<body>

<div class="game-container">
  <div class="game-area">
    <img class="icon trash" src="./ì•„ì´ì½˜ 4.png" />
    <img class="icon music-icon" src="./ìŒì•…ì•„ì´ì½˜.png" />

    <img class="background" src="./ë…¸ì•„ 5ë‹¨ê³„.gif" />

    <!-- ëˆˆ -->
    <div class="eye-wrapper" id="eyeWrapper">
      <img class="eye" id="eye" src="./ëˆˆì•Œ 1.png" />
    </div>

    <!-- ë¦¬ë“¬ê²Œì„ í™”ë©´ / ìºë¦­í„° -->
    <div id="wmpPopup">
      <img src="./ìŒì•…í”Œë ˆì´ì–´.png" class="player-img" />

      <div id="arrowLane"></div>

      <img id="rhythmGame" src="./ë¦¬ë“¬ê²Œì„ í™”ë©´.png">
      <img id="rhythmChar" src="./ë¦¬ë“¬ê²Œì„ ìºë¦­í„°.gif">

      <audio id="music" src="./ë¦¬ë“¬ê²Œì„ ìŒì•….mp3"></audio>

      <div class="controls">
        <button id="btnPrev" class="ctrl-btn">â®</button>
        <button id="btnPlay" class="ctrl-btn">â–¶</button>
        <button id="btnPause" class="ctrl-btn">âšâš</button>
        <button id="btnNext" class="ctrl-btn">â­</button>
      </div>
    </div>
   
    <!-- íŒì • ì‚¬ìš´ë“œ -->
    <audio id="soundBad" src="./ë¦¬ë“¬ê²Œì„ í‹€ë¦´ë•Œ.mp3"></audio>
    <audio id="soundGood" src="./ë¦¬ë“¬ê²Œì„ ë§ì„ë•Œ.mp3"></audio>

    <!-- ì‹œì‘ ë²„íŠ¼ -->
    <div id="startButton">â–¶ PLAY</div>

    <!-- ì„±ê³µ íŒì—… -->
    <div id="successPopup" class="popup">
      ì„±ê³µ!
      <br><br>
      <button id="successOK">OK</button>
    </div>
    <div id="speechBox" class="speech-box">
  <span id="speechText"></span>
</div>


    <!-- ì‹¤íŒ¨ íŒì—… -->
    <div id="failPopup" class="popup">
      ì‹¤íŒ¨..
      <br><br>
      <button id="failOK">OK</button>
    </div>

  </div>
</div>
<script>

/* ================================================================
   ğŸ‘ ë°˜ì‘í˜• ëˆˆì•Œ
================================================================ */
const eye = document.getElementById("eye");
const eyeWrapper = document.getElementById("eyeWrapper");

function updateEyePosition(e) {
  const rect = eyeWrapper.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;
  const dx = e.clientX - cx;
  const dy = e.clientY - cy;

  const maxMove = rect.width * 0.005;
  const mx = Math.max(Math.min(dx / 20, maxMove), -maxMove);
  const my = Math.max(Math.min(dy / 20, maxMove), -maxMove);

  eye.style.transform = `translate(${mx}px, ${my}px)`;
}
window.addEventListener("mousemove", updateEyePosition);
window.addEventListener("resize", () => eye.style.transform = "translate(0,0)");



/* ================================================================
   ğŸµ ë¦¬ë“¬ê²Œì„ ë¡œì§
================================================================ */
const audio = document.getElementById("music");
const arrowLane = document.getElementById("arrowLane");
const startButton = document.getElementById("startButton");
const soundBad = document.getElementById("soundBad");
const soundGood = document.getElementById("soundGood");
const trashIcon = document.querySelector(".trash");
trashIcon.style.pointerEvents = "none";
trashIcon.style.opacity = "1";


const happyChar = "./ë¦¬ë“¬ê²Œì„ ìºë¦­í„° ê¸°ì¨.gif";
const sadChar2 = "./ë¦¬ë“¬ê²Œì„ ìºë¦­í„° ìŠ¬í””.gif";

/* â­ ì¶”ê°€ëœ ë¶€ë¶„ â€” ê²Œì„ ì „ì²´ ë©ˆì¶¤ í”Œë˜ê·¸ */
let gameOver = false;

const TARGET_Y = 56.2;
const SPEED = 1.35;

let activeArrows = [];
let failCount = 0;

/* ìºë¦­í„° */
const rhythmChar = document.getElementById("rhythmChar");
const normalChar = "./ë¦¬ë“¬ê²Œì„ ìºë¦­í„°.gif";
const sadChar = "./ë¦¬ë“¬ê²Œì„ ìºë¦­í„° ìŠ¬í””.gif";

function showSad() {
  rhythmChar.src = sadChar;
  setTimeout(() => {
    if (!gameOver) rhythmChar.src = normalChar;
  }, 1000);
}

/* PNG ë¬¶ìŒ */
const arrowTypes = [
  { type:"left",  normal:"./ë¦¬ë“¬ê²Œì„ ì™¼.png",  perfect:"./ë¦¬ë“¬ê²Œì„ ì™¼ íŒ¡.png",  good:"./ë¦¬ë“¬ê²Œì„ ì™¼ ë³´í†µ.png",  bad:"./ë¦¬ë“¬ê²Œì„ ì™¼ ë‚˜ì¨.png" },
  { type:"down",  normal:"./ë¦¬ë“¬ê²Œì„ ë°‘.png",  perfect:"./ë¦¬ë“¬ê²Œì„ ë°‘ íŒ¡.png",  good:"./ë¦¬ë“¬ê²Œì„ ë°‘ ë³´í†µ.png",  bad:"./ë¦¬ë“¬ê²Œì„ ë°‘ ë‚˜ì¨.png" },
  { type:"up",    normal:"./ë¦¬ë“¬ê²Œì„ ìœ„.png",  perfect:"./ë¦¬ë“¬ê²Œì„ ìœ„ íŒ¡.png",  good:"./ë¦¬ë“¬ê²Œì„ ìœ„ ë³´í†µ.png",  bad:"./ë¦¬ë“¬ê²Œì„ ìœ„ ë‚˜ì¨.png" },
  { type:"right", normal:"./ë¦¬ë“¬ê²Œì„ ì˜¤.png",  perfect:"./ë¦¬ë“¬ê²Œì„ ì˜¤ íŒ¡.png",  good:"./ë¦¬ë“¬ê²Œì„ ì˜¤ ë³´í†µ.png",  bad:"./ë¦¬ë“¬ê²Œì„ ì˜¤ ë‚˜ì¨.png" }
];


/* ================================================================
   ğŸ”º í™”ì‚´í‘œ ìƒì„±
================================================================ */
function spawnArrow(data) {
  const img = document.createElement("img");
  img.src = data.normal;
  img.className = "game-arrow";

  if (data.type === "left")  img.style.left = "-0.3%";
  if (data.type === "down")  img.style.left = "-0.4%";
  if (data.type === "up")    img.style.left = "-0.2%";
  if (data.type === "right") img.style.left = "-0.1%";

  arrowLane.appendChild(img);

  let y = -5;
  const arrowObj = { element: img, y, data, stopped:false, judged:false };
  activeArrows.push(arrowObj);

  function move() {

    /* â­ ì¶”ê°€ëœ ë¶€ë¶„ â€” ì‹¤íŒ¨ ì‹œ ì „ì²´ ë©ˆì¶¤ */
    if (gameOver) return;

    if (!arrowObj.stopped) {
      y += SPEED;
      arrowObj.y = y;
      img.style.bottom = y + "%";

      if (y >= TARGET_Y) {
        arrowObj.stopped = true;
        arrowObj.y = TARGET_Y;
        img.style.bottom = TARGET_Y + "%";

        setTimeout(() => {
          if (!arrowObj.judged) {
            arrowObj.judged = true;
            img.src = arrowObj.data.bad;
            soundBad.currentTime = 0;
            soundBad.play();
            showSad();
            failCount++;

            if (failCount >= 5) showFail();

            setTimeout(() => img.remove(), 260);
            activeArrows = activeArrows.filter(a => a !== arrowObj);
          }
        }, 300);
      }
    }

    if (!arrowObj.judged) requestAnimationFrame(move);
  }
  move();
}



/* ================================================================
   ğŸ® ë°©í–¥í‚¤ íŒì •
================================================================ */
document.addEventListener("keydown", (e) => {

  /* â­ ì¶”ê°€ëœ ë¶€ë¶„ â€” ì‹¤íŒ¨ í›„ í‚¤ ì…ë ¥ ì°¨ë‹¨ */
  if (gameOver) return;

  let keyType = null;
  if (e.key === "ArrowLeft") keyType = "left";
  if (e.key === "ArrowRight") keyType = "right";
  if (e.key === "ArrowUp") keyType = "up";
  if (e.key === "ArrowDown") keyType = "down";
  if (!keyType) return;

  const target = activeArrows[0];
  if (!target || target.judged) return;

  const y = target.y;

  // ë°©í–¥ í‹€ë¦¼ â†’ BAD
  if (target.data.type !== keyType) {
    target.judged = true;
    target.element.src = target.data.bad;
    soundBad.currentTime = 0;
    soundBad.play();
    showSad();
    failCount++;

    if (failCount >= 5) showFail();

    setTimeout(() => target.element.remove(), 260);
    activeArrows.shift();
    return;
  }

  const PERFECT_RANGE = 1.2;
  const GOOD_RANGE = 12;

  if (Math.abs(y - TARGET_Y) <= PERFECT_RANGE) {
    target.judged = true;
    target.element.src = target.data.perfect;
    soundGood.currentTime = 0;
    soundGood.play();

    setTimeout(() => target.element.remove(), 260);
    activeArrows.shift();
    return;
  }

  if (Math.abs(y - TARGET_Y) <= GOOD_RANGE) {
  target.judged = true;
  target.element.src = target.data.good;

  // ğŸ”Š ë³´í†µ(GOOD)ë„ ë§ì•˜ìœ¼ë‹ˆê¹Œ ë§ì„ ë•Œ ì‚¬ìš´ë“œ!
  soundGood.currentTime = 0;
  soundGood.play();

  setTimeout(() => target.element.remove(), 260);
  activeArrows.shift();
  return;
}


  // BAD
  target.judged = true;
  target.element.src = target.data.bad;
  soundBad.currentTime = 0;
  soundBad.play();
  showSad();
  failCount++;

  if (failCount >= 5) showFail();

  setTimeout(() => target.element.remove(), 260);
  activeArrows.shift();
});



/* ================================================================
   ğŸµ ëœë¤ í™”ì‚´í‘œ ìƒì„±
================================================================ */
function startArrowLoop() {
  const interval = 1000; 
  const loop = setInterval(() => {

    /* â­ ì¶”ê°€ëœ ë¶€ë¶„ â€” ì‹¤íŒ¨ í›„ í™”ì‚´í‘œ ìƒì„±ë„ ì¤‘ë‹¨ */
    if (gameOver) {
      clearInterval(loop);
      return;
    }

    if (audio.ended) {
      clearInterval(loop);
      showSuccess();
      return;
    }
    spawnArrow(arrowTypes[Math.floor(Math.random() * arrowTypes.length)]);
  }, interval);
}



/* ================================================================
   â–¶ ì‹œì‘ ë²„íŠ¼
================================================================ */
startButton.onclick = () => {
  startButton.style.display = "none";
  audio.play().then(() => startArrowLoop());
};



/* ================================================================
   ğŸ‰ ì„±ê³µ / ì‹¤íŒ¨ íŒì—…
================================================================ */
const successPopup = document.getElementById("successPopup");
const failPopup = document.getElementById("failPopup");

function showSuccess() {

  // ğŸ”¥ ì„±ê³µ ì´ë¯¸ì§€ë¡œ ë³€ê²½
  rhythmChar.src = happyChar;

  successPopup.style.display = "block";
}


function showFail() {

  /* â­ ì¶”ê°€ëœ ë¶€ë¶„ â€” ì „ì²´ ê²Œì„ ì¤‘ë‹¨ */
  gameOver = true;

  /* ìŒì•… ì •ì§€ */
  audio.pause();
  audio.currentTime = 0;

  /* ìºë¦­í„° ìŠ¬í”” ì´ë¯¸ì§€ */
  rhythmChar.src = sadChar2;

  /* í˜„ì¬ ë‚¨ì•„ìˆëŠ” í™”ì‚´í‘œ ì¦‰ì‹œ ì œê±° */
  activeArrows.forEach(a => {
    if (a.element) a.element.remove();
  });
  activeArrows = [];

  failPopup.style.display = "block";
}


/* ì„±ê³µ OK */
document.getElementById("successOK").onclick = () => {
  successPopup.style.display = "none";

  typeWriter("ì¶•í•˜í•´ ë„ˆê°€ ì´ê²¼ë„¤", () => {
    setTimeout(() => {

      typeWriter("ê·¼ë°, ë°”ë¡œ ëŒë ¤ì¤„ ìˆœ ì—†ì–´.", () => {
        setTimeout(() => {

          typeWriter("ì“°ë ˆê¸°í†µ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ì„œ", () => {
            setTimeout(() => {

              typeWriter("ë„ˆê°€ ë‚˜ë¨¸ì§€ ì•„ì´ì½˜ì„ ì°¾ì•„ì™€ì•¼í•´", () => {

                // â­ ì—¬ê¸°ì„œ ì“°ë ˆê¸°í†µ í™œì„±í™”
                trashIcon.style.pointerEvents = "auto";
                trashIcon.style.opacity = "1";

              });

            }, 600);
          });

        }, 600);
      });

    }, 800);
  });
};





/* ì‹¤íŒ¨ OK */
document.getElementById("failOK").onclick = () => {
  location.reload();
};



/* ================================================================
   ğŸ“ Music Virusì™€ ë™ì¼í•œ íƒ€ìê¸° íš¨ê³¼
================================================================ */
const speechBox = document.getElementById("speechBox");
const speechText = document.getElementById("speechText");

function typeWriter(text, onComplete) {
  speechBox.style.display = "block";
  speechText.textContent = "";

  let i = 0;

  function typing() {
    if (i < text.length) {
      speechText.textContent += text[i];

      const s = new Audio("./ë¦¬ë“¬ê²Œì„ ìºë¦­í„° ì†Œë¦¬.mp3");
      s.volume = 0.45;
      s.play();

      i++;
      setTimeout(typing, 70);
    } else {
      if (onComplete) onComplete();
    }
  }

  typing();
}

trashIcon.addEventListener("click", () => {
  location.href = "./noah run last.html"; // â† ë„¤ê°€ ë§Œë“  ë‹¤ìŒ HTML
});


</script>


</body>
</html>








