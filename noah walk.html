<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Noah Movement</title>
  <style>
    html, body {
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  margin: 0;
  padding: 0;
  background: #000;  /* ë°”ê¹¥ì€ ê²€ì •ìœ¼ë¡œ ì±„ì›Œì„œ ê²Œì„ë°•ìŠ¤ë§Œ ë³´ì—¬ */
}


    #game {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);

  /* 16:9 ê³ ì • ìº”ë²„ìŠ¤ */
  width: calc(100vh * (16 / 9));
  height: 100vh;

  /* í™”ë©´ì´ ì„¸ë¡œë¡œ ë„ˆë¬´ ê¸¸ ë•Œ ìë™ ì¡°ì ˆ */
  max-width: 100vw;
  max-height: calc(100vw * (9 / 16));

  overflow: hidden;

  background-image: url('./ë…¸ì•„ë°°ê²½1.png'), url('./ë…¸ì•„ ë°°ê²½ ì´ì–´ì§.png');
  background-size: contain, contain;
  background-position: center center, right center;
  background-repeat: no-repeat, repeat-x;

  transition: opacity 0.5s ease-in-out;
  opacity: 1;
}



    #game.fade-out { opacity: 0; }
    #game.fade-in { opacity: 1; }

    #noah {
      position: absolute;
      width: 50vw;
      top: 50vh;
      left: 76.3vw;
      transform: translate(-50%, -50%);
      image-rendering: pixelated;
      z-index: 2;
    }

    #shadow {
      position: absolute;
      width: 10vw;
      aspect-ratio: 3 / 1;
      background: rgba(0, 0, 0, 0.15);
      border-radius: 50%;
      left: 50vw;
      transform: translate(-50%, 0);
      filter: blur(0.8px);
      z-index: 1;
    }

    #interactionText {
      position: absolute;
      bottom: 12vh;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'DungGeunMo', monospace;
      color: white;
      font-size: 2.5vh;
      background: rgba(0, 0, 0, 0.5);
      padding: 1vh 2vh;
      border-radius: 1vh;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      pointer-events: none;
      z-index: 3;
    }
    /* ğŸ’¼ ì—„ë§ˆë°© ì§€ê°‘ */
#wallet {
  position: absolute;
  width: 50vw;
  bottom: 14vh;
  left: 48vw;
  transform: translate(-50%, 0);
  z-index: 3;
  image-rendering: pixelated;
  display: none; /* ê¸°ë³¸ì€ ìˆ¨ê¹€ */
  transition: filter 0.25s ease, transform 0.25s ease;
  cursor: pointer;
}

/* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ë°˜ì§ì´ê²Œ */
/* ğŸ§± í”½ì…€ ëŠë‚Œ í…Œë‘ë¦¬ hover (ì–‡ê³  ì„ ëª…í•˜ê²Œ) */
#wallet:hover {
  filter: drop-shadow(0 0 10px #ffcc00) brightness(1.2);
  transform: translate(-50%, 0) scale(1.05);
}

  </style>
</head>
<body>
  <div id="game">
    <div id="shadow"></div>
    <img id="noah" src="ë…¸ì•„ì •ë©´.gif" alt="ë…¸ì•„ ìºë¦­í„°" />
    <img id="wallet" src="./ì§€ê°‘.png" alt="ì—„ë§ˆì˜ ì§€ê°‘" />

    <div id="interactionText"></div>
  </div>

  <script>
const noah = document.getElementById("noah");
const shadow = document.getElementById("shadow");
const game = document.getElementById("game");
const text = document.getElementById("interactionText");

let x = 76.3;
let y = 50;
const speed = 0.3;
let moving = false;
let direction = null;
let currentBackground = 1;
let nearDoor = false;
let doorAction = null;

// ğŸ”Š ì‚¬ìš´ë“œ
const walkSound = new Audio('./ë…¸ì•„ ê±·ê¸°.mp3');
walkSound.volume = 0.45;
walkSound.loop = true;
walkSound.preload = "auto";

const doorOpenSound = new Audio('./ë¬¸ì—´ê¸°.mp3');
doorOpenSound.volume = 0.55;

const doorCloseSound = new Audio('./ë¬¸ë‹«ìŒ.mp3');
doorCloseSound.volume = 0.55;

// ğŸ”¹ ì´ˆê¸° ë°°ê²½ (ë°°ê²½ 1 + ì´ì–´ì§)
window.addEventListener("load", () => {
  game.style.backgroundImage = "url('./ë…¸ì•„ë°°ê²½1.png'), url('./ë…¸ì•„ ë°°ê²½ ì´ì–´ì§.png')";
  game.style.backgroundRepeat = "no-repeat, repeat-x";
  game.style.backgroundSize = "contain, contain";
  game.style.backgroundPosition = "center, right center";
  updateShadowPosition();
});
const walletSound = new Audio('./ì§€ê°‘ì°¾ìŒ.mp3');
walletSound.volume = 0.75; // ë³¼ë¥¨ ì¡°ì ˆ ê°€ëŠ¥
walletSound.preload = "auto";

const bgm1 = new Audio('./ë°°ê²½ìŒ.mp3'); // ë°°ê²½ 1,2
bgm1.volume = 0.4;
bgm1.loop = true;
bgm1.preload = "auto";

const bgm2 = new Audio('./ë©”ì¼ ë°”ì´ëŸ¬ìŠ¤ ë°°ê²½ìŒ.mp3'); // ì—„ë§ˆë°©
bgm2.volume = 0.4;
bgm2.loop = true;
bgm2.preload = "auto";


function updateShadowPosition() {
  const noahRect = noah.getBoundingClientRect();
  const gameRect = game.getBoundingClientRect();
  const noahBottomVh = ((noahRect.bottom - gameRect.top) / window.innerHeight) * 100;
  const noahLeftVw = ((noahRect.left - gameRect.left) / window.innerWidth) * 100;
  const noahWidthVw = (noahRect.width / window.innerWidth) * 100;
  shadow.style.top = (noahBottomVh - 10) + "vh";
  shadow.style.left = (noahLeftVw + noahWidthVw / 2.1 + 2.1) + "vw";
}

// ğŸŒ« í˜ì´ë“œ ì „í™˜
function triggerFade(callback) {
  game.style.transition = "opacity 0.35s ease-in";
  noah.style.transition = "opacity 0.35s ease-in";
  game.style.opacity = 0;
  noah.style.opacity = 0;

  setTimeout(() => {
    if (callback) callback();
    requestAnimationFrame(() => {
      game.style.transition = "opacity 0.45s ease-out";
      noah.style.transition = "opacity 0.45s ease-out";
      game.style.opacity = 1;
      noah.style.opacity = 1;
    });
  }, 350);
}

// ğŸ§­ ë°°ê²½ ì´ë™
function goToBackground(newBg) {
  nearDoor = false;
  text.style.opacity = 0;
  currentBackground = newBg;
let lockMomBgm = false;  // ì—„ë§ˆë°©ì—ì„œ ì§€ê°‘ ì±™ê¸´ í›„ bgm ì „í™˜ ì ê¸ˆ

  /* ğŸµ ìë™ ë°°ê²½ìŒ ì „í™˜ */
if (!lockMomBgm) {
  if (newBg === 1 || newBg === 2) {
    bgm2.pause();
    bgm1.currentTime = 0;
    bgm1.play().catch(() => {});
  } else if (newBg === 3) {
    bgm1.pause();
    bgm2.currentTime = 0;
    bgm2.play().catch(() => {});
  }
}



  const applyChange = () => {
    if (newBg === 1) {
      // ì™„ì „íˆ í†µì¼ëœ ë°°ê²½1 ì„¤ì • âœ…
      game.style.backgroundImage = "url('./ë…¸ì•„ë°°ê²½1.png'), url('./ë…¸ì•„ ë°°ê²½ ì´ì–´ì§.png')";
      game.style.backgroundRepeat = "no-repeat, repeat-x";
      game.style.backgroundSize = "contain, contain";
      game.style.backgroundPosition = "center, right center";
    } else if (newBg === 2) {
      game.style.backgroundImage = "url('./ë…¸ì•„ë°°ê²½2.png'), url('./ë…¸ì•„ ë°°ê²½ ì´ì–´ì§.png')";
      game.style.backgroundRepeat = "no-repeat, repeat-x";
      game.style.backgroundSize = "contain, contain";
      game.style.backgroundPosition = "left center, right center";
    } else if (newBg === 3) {
      game.style.backgroundImage = "url('./ë…¸ì•„ ì—„ë§ˆë°©.gif')";
      game.style.backgroundRepeat = "no-repeat";
      game.style.backgroundSize = "contain";
      game.style.backgroundPosition = "center";
    }
  };

  triggerFade(applyChange);
}

function instantPositionUpdate() {
  noah.style.left = x + "vw";
  noah.style.top = y + "vh";
  updateShadowPosition();
}

function showText(message) {
  text.textContent = message;
  text.style.opacity = 1;
}

function hideText() {
  text.style.opacity = 0;
}

// ğŸ® ì´ë™ ì œì–´
document.addEventListener("keydown", (e) => {
  if (moving) return;
  const validKeys = ["ArrowLeft", "ArrowRight", "ArrowUp", "ArrowDown"];
  if (!validKeys.includes(e.key)) return;
  moving = true;

  // ğŸ”Š ê±·ê¸° ì‹œì‘í•˜ë©´ ë°œì†Œë¦¬ ì¬ìƒ
  walkSound.currentTime = 0;
  walkSound.play().catch(() => {});

  if (e.key === "ArrowLeft") {
    direction = "left";
    noah.src = (currentBackground === 3) ? "ë…¸ì•„ ì‚´ê¸ˆì‚´ê¸ˆ.gif" : "ë…¸ì•„ ê±·ê¸° ì¬ìˆ˜ì •.gif";
    noah.style.transform = "translate(-50%, -50%) scaleX(1)";
  } else if (e.key === "ArrowRight") {
    direction = "right";
    noah.src = (currentBackground === 3) ? "ë…¸ì•„ ì‚´ê¸ˆì‚´ê¸ˆ.gif" : "ë…¸ì•„ ê±·ê¸° ì¬ìˆ˜ì •.gif";
    noah.style.transform = "translate(-50%, -50%) scaleX(-1)";
  } else if (e.key === "ArrowUp") {
    direction = "up";
    noah.src = (currentBackground === 3) ? "ì‚´ê¸ˆì‚´ê¸ˆ ë’·ë©´.gif" : "ë…¸ì•„ ë’¤ê±·ê¸°.gif";
  } else if (e.key === "ArrowDown") {
    direction = "down";
    noah.src = (currentBackground === 3) ? "ì‚´ê¸ˆì‚´ê¸ˆ ì •ë©´.gif" : "ë…¸ì•„ ì•ê±·ê¸°.gif";
  }

  const moveLoop = setInterval(() => {
    if (!moving) {
      clearInterval(moveLoop);
      return;
    }

    if (direction === "left") x -= speed;
    if (direction === "right") x += speed;
    if (direction === "up") y -= speed;
    if (direction === "down") y += speed;

    // ğŸ”¸ ë°°ê²½ë³„ ì´ë™ ì œí•œ
    if (currentBackground === 1) x = Math.max(5, Math.min(90, x));
    else if (currentBackground === 2) x = Math.max(8, Math.min(92, x));
    else if (currentBackground === 3) x = Math.max(8, Math.min(78, x));
    y = Math.max(25, Math.min(85, y));

    instantPositionUpdate();

    nearDoor = false;
    doorAction = null;

    if (currentBackground === 2 && x <= 10) {
      showText("â¡ ì—„ë§ˆë°© ë“¤ì–´ê°€ê¸° (Z)");
      nearDoor = true;
      doorAction = "enterMom";
    } else if (currentBackground === 3 && x >= 75) {
      showText("â¬… ë‚˜ê°€ê¸° (Z)");
      nearDoor = true;
      doorAction = "exitMom";
    } else hideText();

    if (x <= 5 && currentBackground === 1) {
      goToBackground(2);
      x = 90;
      instantPositionUpdate();
    } else if (x >= 92 && currentBackground === 2) {
      goToBackground(1);
      x = 10;
      instantPositionUpdate();
    }

  }, 16);
});

// ğŸ§ ì •ì§€ ì´ë¯¸ì§€ + ë°œì†Œë¦¬ ë©ˆì¶¤
document.addEventListener("keyup", (e) => {
  const validKeys = ["ArrowLeft", "ArrowRight", "ArrowUp", "ArrowDown"];
  if (validKeys.includes(e.key)) {
    moving = false;
    walkSound.pause();
    walkSound.currentTime = 0;

    if (currentBackground === 3) {
      if (direction === "up") noah.src = "ì‚´ê¸ˆì‚´ê¸ˆ ë’·ë©´.gif";
      else if (direction === "down") noah.src = "ì‚´ê¸ˆì‚´ê¸ˆ ì •ë©´.gif";
      else noah.src = "ì‚´ê¸ˆì‚´ê¸ˆ ë©ˆì¶¤.png";
    } else {
      if (direction === "up") noah.src = "ë…¸ì•„ ë’·ë©´.gif";
      else if (direction === "down") noah.src = "ë…¸ì•„ì •ë©´.gif";
      else noah.src = "ë…¸ì•„ì •ë©´.gif";
    }
  }
});

// ğŸ”¹ ë¬¸ ìƒí˜¸ì‘ìš© (ì—„ë§ˆë°© í¬í•¨ + ë¬¸ì†Œë¦¬)
document.addEventListener("keydown", (e) => {
  if (e.key === "z" || e.key === "Z") {
    if (nearDoor && doorAction === "enterMom") {
      doorOpenSound.currentTime = 0;
      doorOpenSound.play().catch(() => {});
      goToBackground(3);
      x = 75; y = 55;
      noah.src = "ë…¸ì•„ ì‚´ê¸ˆì‚´ê¸ˆ.gif";
      instantPositionUpdate();
    } else if (nearDoor && doorAction === "exitMom") {
      lockMomBgm = false;

  // ğŸµ ë³µë„ë¡œ ë‚˜ì˜¤ëŠ” ìˆœê°„ bgm1 ì¬ìƒ
  bgm2.pause();
  bgm1.currentTime = 0;
  bgm1.play().catch(() => {});
      doorCloseSound.currentTime = 0;
      doorCloseSound.play().catch(() => {});
      goToBackground(2);
      x = 12; y = 55;
      noah.src = "ë…¸ì•„ì •ë©´.gif";
      instantPositionUpdate();
    }
  }
});

window.addEventListener("resize", updateShadowPosition);
/* ============================================
ğŸ’¼ ì—„ë§ˆ ì§€ê°‘ ë™ì‘ ë¡œì§
============================================ */
const wallet = document.getElementById("wallet");
let walletTaken = false;

// ğŸ•° ì—„ë§ˆë°©ì— ë“¤ì–´ê°„ í›„ 1.3ì´ˆ ë’¤ ìë§‰ & ì§€ê°‘ ë“±ì¥ (í•œ ë²ˆë§Œ ë“±ì¥)
function handleWalletScene() {
  // ì´ë¯¸ ì§€ê°‘ì„ ì±™ê²¼ìœ¼ë©´ í‘œì‹œ ì•ˆ í•¨
  if (walletTaken) {
    wallet.style.display = "none";
    return;
  }

  // ì—„ë§ˆë°©ì¼ ë•Œë§Œ ì‹¤í–‰
  if (currentBackground === 3 && !walletTaken) {
    // í˜ì´ë“œ ì™„ë£Œ í›„ ë“±ì¥ (0.7ì´ˆ ì§€ì—°)
    setTimeout(() => {
      wallet.style.display = "block";
      wallet.style.opacity = "0";
      wallet.style.transition = "opacity 0.6s ease";
      requestAnimationFrame(() => {
        wallet.style.opacity = "1";
      });

      // ğŸ’¬ 1.3ì´ˆ ë’¤ ëŒ€ì‚¬ í‘œì‹œ
      setTimeout(() => {
        showText("ì—„ë§ˆ ì§€ê°‘ì€ í™”ì¥ëŒ€ì— ìˆëŠ” ê²ƒ ê°™ì•„...");
      }, 1300);
    }, 400);
  } else {
    wallet.style.display = "none";
  }
}

// ğŸ’¬ ì§€ê°‘ í´ë¦­ ì‹œ ì‚¬ë¼ì§€ê³  ëŒ€ì‚¬ ì¶œë ¥
wallet.addEventListener("click", () => {
  if (currentBackground === 3 && !walletTaken) {
    walletTaken = true;
    lockMomBgm = true;
    walletSound.currentTime = 0;
    walletSound.play().catch(() => {});
    wallet.style.transition = "opacity 0.4s ease-out, transform 0.4s ease-out";
    wallet.style.opacity = "0";
    wallet.style.transform = "translate(-50%, 0) scale(0.7)";
    showText("ë…¸ì•„ê°€ ì§€ê°‘ì„ ì±™ê²¼ë‹¤.");
    setTimeout(() => {
      wallet.style.display = "none";
      wallet.style.opacity = "1";
      hideText();
    }, 1500);
  }
});

// ğŸ¯ ë°°ê²½ ì „í™˜ ì‹œë§ˆë‹¤ ê°ì§€ â€” ì—„ë§ˆë°©ì´ë©´ handleWalletScene ì‹¤í–‰
const observer = new MutationObserver(() => handleWalletScene());
observer.observe(game, { attributes: true, attributeFilter: ["style"] });
/* ============================================
ğŸšª ë‹¤ì‹œ ë°©ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ (ì—”ë”© íŠ¸ë¦¬ê±°)
============================================ */
const backToRoomBtn = document.createElement("button");
backToRoomBtn.textContent = "ë‹¤ì‹œ ë°©ìœ¼ë¡œ ë“¤ì–´ê°€ê¸°";
backToRoomBtn.style.position = "fixed";
backToRoomBtn.style.bottom = "8vh";
backToRoomBtn.style.right = "6vw";
backToRoomBtn.style.padding = "1.2vh 2.5vw";
backToRoomBtn.style.fontFamily = "'DungGeunMo', monospace";
backToRoomBtn.style.fontSize = "2.3vh";
backToRoomBtn.style.background = "black";
backToRoomBtn.style.color = "#ffcc00";
backToRoomBtn.style.border = "2px solid #ffcc00";
backToRoomBtn.style.borderRadius = "6px";
backToRoomBtn.style.cursor = "pointer";
backToRoomBtn.style.zIndex = "10";
backToRoomBtn.style.display = "none";
backToRoomBtn.style.transition = "all 0.2s ease";
backToRoomBtn.style.animation = "blink 1s infinite alternate";

// hover íš¨ê³¼
backToRoomBtn.addEventListener("mouseenter", () => {
  backToRoomBtn.style.background = "#ffcc00";
  backToRoomBtn.style.color = "black";
});
backToRoomBtn.addEventListener("mouseleave", () => {
  backToRoomBtn.style.background = "black";
  backToRoomBtn.style.color = "#ffcc00";
});

// í˜ì´ì§€ì— ì¶”ê°€
document.body.appendChild(backToRoomBtn);

// ì˜¤ë¥¸ìª½ ê·¼ì²˜ ë„ë‹¬ ì‹œ ë²„íŠ¼ í‘œì‹œ (ì¡°ê¸ˆ ë” ì¼ì° ë‚˜íƒ€ë‚˜ë„ë¡ ìˆ˜ì •)
function checkForExitButton() {
  // ì´ì „ì—” x >= 85 â†’ ì´ì œëŠ” x >= 70 ì •ë„ì—ì„œ ë“±ì¥!
  if (currentBackground === 1 && x >= 70) {
    backToRoomBtn.style.display = "block";
  } else {
    backToRoomBtn.style.display = "none";
  }
}


// ì´ë™í•  ë•Œë§ˆë‹¤ ê°ì§€
setInterval(checkForExitButton, 200);

// ë²„íŠ¼ í´ë¦­ ì‹œ ê²€ì€í™”ë©´ + ë¬¸ì†Œë¦¬ + ì´ë™
// ë²„íŠ¼ í´ë¦­ ì‹œ ê²€ì€í™”ë©´ + ë¬¸ì†Œë¦¬ + ì´ë™
backToRoomBtn.addEventListener("click", () => {
  // ğŸ”’ ì§€ê°‘ì„ ì•„ì§ ì•ˆ ì±™ê²¼ìœ¼ë©´ ì—”ë”© ì§„ì… ë¶ˆê°€ + ìë§‰ ì¶œë ¥
  if (!walletTaken) {
    showText("ì§€ê°‘ì„ ë¨¼ì € ê°€ì ¸ì™€ì•¼ í•´...");
    setTimeout(() => hideText(), 1500);
    return;
  }
  backToRoomBtn.style.display = "none";

  // ğŸ”² í™”ë©´ ì „ì²´ ê²€ì€ ë°°ê²½
  const fadeOverlay = document.createElement("div");
  fadeOverlay.style.position = "fixed";
  fadeOverlay.style.top = "0";
  fadeOverlay.style.left = "0";
  fadeOverlay.style.width = "100vw";
  fadeOverlay.style.height = "100vh";
  fadeOverlay.style.background = "black";
  fadeOverlay.style.opacity = "0";
  fadeOverlay.style.transition = "opacity 1s ease";
  fadeOverlay.style.zIndex = "9999";
  document.body.appendChild(fadeOverlay);

  // í˜ì´ë“œì¸ ì‹œì‘
  setTimeout(() => (fadeOverlay.style.opacity = "1"), 100);

  // ğŸ”Š ë¬¸ ì—¬ë‹«ëŠ” ì†Œë¦¬
  const doorOpen = new Audio("./ë¬¸ì—´ê¸°.mp3");
  const doorClose = new Audio("./ë¬¸ë‹«ìŒ.mp3");
  doorOpen.volume = 0.8;
  doorClose.volume = 0.8;

  // ë¬¸ ì—´ë¦¼
  setTimeout(() => {
    doorOpen.play().catch(() => {});
  }, 700);

  // ë¬¸ ë‹«í˜
  setTimeout(() => {
    doorClose.play().catch(() => {});
  }, 2000);

  // 3ì´ˆ í›„ ë‹¤ìŒ ì”¬ ì´ë™
  setTimeout(() => {
    window.location.href = "noah computer main 3 quest.html";
  }, 3000);
});
document.addEventListener("click", () => {
  bgm1.play().catch(() => {});
});


</script>
</body>
</html>














