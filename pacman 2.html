<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Noah Pacman â€” Limit + Wall Collision + All Coins + Big Coins + Sound + Stage Complete</title>
<link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2107@1.0/DungGeunMo.css" rel="stylesheet">
<style>
  /* ============================================================
     ğŸŒ‘ ê¸°ë³¸ ì„¸íŒ…
     ============================================================ */
  html, body {
    margin: 0;
    padding: 0;
    width: 100vw;
    height: 100vh;
    background: black;
    overflow: hidden;
  }
  .game-container {
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: black;
  overflow: hidden;
}

.game-area {
  position: relative;
  width: calc(100vh * (16 / 9)); /* 16:9 ì„¸ë¡œ ê¸°ì¤€ */
  height: 100vh;

  max-width: 100vw;  /* ê°€ë¡œê°€ ë” ë„“ì„ ë•Œ */
  max-height: calc(100vw * (9 / 16));

  overflow: hidden;
}

  .stage {
  position: relative;
  width: 100%;
  height: 100%;
}

  .background {
    position: absolute;
    width: 100%;
    height: 100%;
    background: url('./íŒ©ë§¨-ìŠ¤í…Œì´ì§€-2-ìˆ˜ì •.png') center/contain no-repeat;
    z-index: 0;
  }

  /* ============================================================
     ğŸ¬ ì½”ì¸ (ì‘ì€ ì½”ì¸) - ì´ë¯¸ì§€ + íšŒì „
     ============================================================ */
  .coin {
    position: absolute;
    width: 0.9vw;
    height: 0.9vw;
    background: url('./ì½”ì¸.png') center/contain no-repeat;
    background-size: 100% auto;
    image-rendering: pixelated;
    z-index: 2;
    transition: opacity 0.15s ease, transform 0.15s ease;
    animation: coinSpin 2s linear infinite;
  }
  @keyframes coinSpin {
    0% { transform: rotateY(0deg); }
    50% { transform: rotateY(180deg) scale(1.1); filter: brightness(1.4); }
    100% { transform: rotateY(360deg); }
  }

  /* ============================================================
     ğŸ‘‘ ì™•ì½”ì¸ - ì´ë¯¸ì§€ + ë°˜ì§ íšŒì „
     ============================================================ */
  .big-coin {
    position: absolute;
    width: 2.5vw;
    height: 2.5vw;
    background: url('./ì™•ì½”ì¸.png') center/contain no-repeat;
    image-rendering: pixelated;
    z-index: 4;
    animation: bigSpin 2s linear infinite;
    filter: drop-shadow(0 0 0.3vw gold);
  }
  @keyframes bigSpin {
    0% { transform: rotateY(0deg); filter: brightness(1) drop-shadow(0 0 0.3vw gold); }
    50% { transform: rotateY(180deg); filter: brightness(1.6) drop-shadow(0 0 0.6vw gold); }
    100% { transform: rotateY(360deg); filter: brightness(1) drop-shadow(0 0 0.3vw gold); }
  }

  /* ============================================================
     ğŸ˜‹ íŒ©ë§¨
     ============================================================ */
  .pacman {
  position: absolute;
  width: 5.2%;             /* ğŸ”¹ ì•½ê°„ í¬ê²Œ ì¡°ì • ê°€ëŠ¥ */
  height: auto;
  background: none;
  image-rendering: pixelated;
  z-index: 5;
  transition: transform 0.05s linear;
}
.pacman img {
  width: 100%;
  height: auto;
  display: block;
  image-rendering: pixelated;
}


  /* ============================================================
     ğŸŸ© ì´ë™ ì œí•œ ê²½ê³„ (limit-area)
     ============================================================ */
  .limit-area {
  position: absolute;
  top: 8.5%;
  left: 4%;
  width: 91.7%;
  height: 82%;
  pointer-events: none;
  border: 0.3vh dashed rgba(0, 255, 64, 0); /* ë””ë²„ê¹… ì‹œ ë¶ˆíˆ¬ëª…ë„ë¡œ í™•ì¸ */
}    /* ì´ë™ ê°€ëŠ¥ ì„¸ë¡œ */
    
    
  

  /* ============================================================
     ğŸš« ë‚´ë¶€ ì¥ì• ë¬¼ ë²½ (íˆ¬ëª…) - ì¶©ëŒë§Œ
     ============================================================ */
  .wall {
    position: absolute;
    border: 0.3vh dashed rgba(0, 255, 64, 0); /* í•„ìš” ì‹œ 0.6 ë“±ìœ¼ë¡œ í™•ì¸ */
    z-index: 3;
    pointer-events: none;
    opacity: 0; /* ì™„ì „ ìˆ¨ê¹€ */
  }

  /* ============================================================
     ğŸ‰ ìŠ¤í…Œì´ì§€ ì™„ë£Œ ë¬¸êµ¬
     ============================================================ */
  .stage-complete {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-family: 'DungGeunMo', monospace;
  font-size: 4vw;
  color: #00fff2;
  text-shadow:
    0 0 0.4vw #00ffff,
    0 0 0.8vw #00e0ff,
    0 0 1.6vw #0099ff,
    0 0 2.4vw #0066ff;
  letter-spacing: 0.1em;
  text-align: center;
  display: none;
  z-index: 20;
  /* ğŸ‘‡ ê¹œë¹¡ì„ë§Œ ìœ ì§€í•˜ê³  í¬ê¸° ë³€í™” ì œê±° */
  animation: stageBlink 1s infinite alternate;
}
  

/* âš ï¸ ê²½ê³ ì°½ (ì´ë¯¸ì§€ë§Œ ì‘ê²Œ ì¤‘ì•™ì— í‘œì‹œ) */
.jumpscare-overlay {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
   background: rgba(0, 0, 0, 0.268);
  background-image: url('./íŒ©ë§¨\ ê°ì„±.png');
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;
  image-rendering: pixelated;
  z-index: 999999;
  display: none;
  animation: warningFlash 1s ease-in-out infinite alternate,
             warningGlitch 0.3s ease-in-out infinite alternate;
  filter:  contrast(1.5) saturate(1.2);
}


@keyframes warningGlitch {
  0% { transform: scale(1); }
  25% { transform: scale(1.03) rotate(0.3deg); filter: brightness(1.4) contrast(1.5); }
  50% { transform: scale(1.02) rotate(-0.2deg); filter: brightness(1.6) contrast(1.3); }
  75% { transform: scale(1.04) rotate(0.4deg); filter: brightness(1.3) contrast(1.4); }
  100% { transform: scale(1); filter: brightness(1); }
}


@keyframes warningFlash {
  0%   { opacity: 0.8; filter: contrast(1.2); }
  100% { opacity: 1;   filter: contrast(2) hue-rotate(15deg); }
}

.evil-pacman {
  position: absolute;
  width: 5.2vw;
  height: auto;
  image-rendering: pixelated;
  z-index: 5;
  display: none;
  transition: left 0.08s linear, top 0.08s linear;
}
.evil-pacman img {
  width: 100%;
  height: auto;
  display: block;
  image-rendering: pixelated;
}



</style>
</head>
<body>
  
<!-- âš ï¸ ê²½ê³  ë°°ê²½ + ê²½ê³  ì´ë¯¸ì§€ ë¶„ë¦¬ -->
  <div class="jumpscare-overlay" id="jumpscareOverlay"></div>
  <audio id="screamSound" src="./íŒ©ë§¨ ê´´ì„±.mp3" preload="auto"></audio>
</div> 
<div class="game-container">
  <div class="game-area">

  <div class="stage" id="stage">
    <div class="background"></div>
    <div class="limit-area" id="limit"></div> <!-- ì´ë™ ì œí•œ ê²½ê³„ -->

    <!-- =======================
         ğŸ”’ ë³´ì´ì§€ ì•ŠëŠ” ë²½ (ì¶©ëŒë§Œ)
         ======================= -->
    <div class="wall" style="top: 19.7%; left: 11.8%; width: 4.1%; height: 69.8%;"></div>
<div class="wall" style="top: 19.7%; left: 83.8%; width: 4.1%; height: 69.8%;"></div>

<div class="wall" style="top: 10%; left: 20.7%; width: 4.1%; height: 69.8%;"></div>
<div class="wall" style="top: 10%; left: 74.8%; width: 4.1%; height: 69.8%;"></div>

<div class="wall" style="top: 19.7%; left: 29.8%; width: 4.1%; height: 69.8%;"></div>
<div class="wall" style="top: 19.7%; left: 65.8%; width: 4.1%; height: 60%;"></div>

<div class="wall" style="top: 21%; left: 35.7%; width: 22.4%; height: 7.3%;"></div>
<div class="wall" style="top: 37%; left: 41.6%; width: 22.4%; height: 7.3%;"></div>
<div class="wall" style="top: 52.4%; left: 35.7%; width: 22.4%; height: 7.3%;"></div>
<div class="wall" style="top: 68.5%; left: 41.6%; width: 22.4%; height: 7.3%;"></div>
<div class="wall" style="top: 84%; left: 35.7%; width: 25.5%; height: 5.5%;"></div>


    <!-- íŒ©ë§¨ -->
    <div class="evil-pacman" id="evilPacman">
    <img src="./íŒ©ë§¨ ë³µì œ.gif" alt="Evil Pacman"></div>
    <div class="pacman" id="pacman">
  <img src="./íŒ©ë§¨.gif" alt="Pacman">
</div>


  <!-- ğŸ‰ ìŠ¤í…Œì´ì§€ ì™„ë£Œ ë¬¸êµ¬ -->
  <div class="stage-complete" id="stageCompleteText">STAGE ONE CLEAR!</div>

  <!-- ğŸµ ì½”ì¸ ì†Œë¦¬ -->
  <audio id="coinSound" src="ì½”ì¸ì†Œë¦¬.mp3" preload="auto"></audio>
  <audio id="smallCoinSound" src="ì‘ì€ì½”ì¸.mp3" preload="auto"></audio>

  <!-- ğŸµ íš¨ê³¼ìŒ -->
<audio id="errorSound" src="./ê²Œì„ ì°½ ì—ëŸ¬.mp3" preload="auto"></audio>
<!-- ğŸµ ë°°ê²½ ìŒì•… -->
<audio id="bgm1" src="./íŒ©ë§¨ ë°°ê²½ìŒ.mp3" preload="auto" loop></audio>
<audio id="bgm2" src="./íŒ©ë§¨ ê°ì„± í›„ ìŒì•….mp3" preload="auto" loop></audio>


<!-- âš ï¸ ê²½ê³  ì´ë¯¸ì§€ -->
<div class="warning-screen" id="warningScreen"></div>
  </div> <!-- game-area -->
</div> <!-- game-container -->

<script>
/* ============================================================
   ğŸ® Noah Pacman â€” â€œë¹¨ê°„ ë„¤ëª¨ ì•ˆ + ë²½ ì¶©ëŒ + ëª¨ë“  ì½”ì¸ + ì™•ì½”ì¸ + ì†Œë¦¬ + ì™„ë£Œë¬¸êµ¬â€
============================================================ */
const stage = document.getElementById("stage");
const pacman = document.getElementById("pacman");
const limit  = document.getElementById("limit");
const coinSound = document.getElementById("coinSound");
const smallCoinSound = document.getElementById("smallCoinSound"); // ì¼ë°˜ ì½”ì¸ ì†Œë¦¬
const bgm1 = document.getElementById("bgm1");
const bgm2 = document.getElementById("bgm2");

bgm1.volume = 0.55;  
bgm2.volume = 0.6;

/* ğŸ‘¿ ì  íŒ©ë§¨ ì¶”ê²©ìš© ë³€ìˆ˜ */
const evilPacman = document.getElementById("evilPacman");
let positions = [];         // í”Œë ˆì´ì–´ ê²½ë¡œ ê¸°ë¡
let recordTimer = null;     // ê²½ë¡œ ê¸°ë¡ íƒ€ì´ë¨¸
let followTimer = null;     // ì¶”ê²© íƒ€ì´ë¨¸
let evilActive = false;     // ì¶”ê²© ì¤‘ ì—¬ë¶€
let bgmStarted = false;



let x = 6; // íŒ©ë§¨ ì‹œì‘ X (vw)
let y = 79; // íŒ©ë§¨ ì‹œì‘ Y (vh)
const speed = 1; // ì´ë™ ì†ë„ (vw/vh ë‹¨ìœ„ ê°œë…ì ìœ¼ë¡œ ì¼ì¹˜)

pacman.style.left = x + "%";
pacman.style.top  = y + "%";

/* ============================================================
   ğŸ¬ ì½”ì¸ ì¢Œí‘œ (ì „ë¶€ ìœ ì§€, ìƒëµ ì—†ìŒ)
============================================================ */
const coinPositions = [
  // ë§¨ì™¼ìª½ ì¤„
  {x: 7.8, y: 14}, {x: 7.8, y: 18}, {x: 7.8, y: 22}, {x: 7.8, y: 26}, {x: 7.8, y: 30}, {x: 7.8, y: 34}, {x: 7.8, y: 38}, {x: 7.8, y: 42}, {x: 7.8, y: 46},
  {x: 7.8, y: 50}, {x: 7.8, y: 54}, {x: 7.8, y: 58}, {x: 7.8, y: 62}, {x: 7.8, y: 66}, {x: 7.8, y: 70}, {x: 7.8, y: 74}, {x: 7.8, y: 78},

  {x: 10, y: 14}, {x: 11.8, y: 14}, {x: 13.6, y: 14}, {x: 15.4, y: 14}, {x: 17.2, y: 14}, 

  {x: 18.2, y: 18}, {x: 18.2, y: 22}, {x: 18.2, y: 26}, {x: 18.2, y: 30}, {x: 18.2, y: 34}, {x: 18.2, y: 38}, {x: 18.2, y: 42}, {x: 18.2, y: 46},
  {x: 18.2, y: 50}, {x: 18.2, y: 54}, {x: 18.2, y: 58}, {x: 18.2, y: 62}, {x: 18.2, y: 66}, {x: 18.2, y: 70}, {x: 18.2, y: 74}, {x: 18.2, y: 78}, {x: 18.2, y: 82},
  {x: 18.2, y: 86},

  {x: 20.2, y: 86}, {x: 22, y: 86}, {x: 23.8, y: 86}, {x: 25.6, y: 86}, 

  {x: 27.1, y: 18}, {x: 27.1, y: 22}, {x: 27.1, y: 26}, {x: 27.1, y: 30}, {x: 27.1, y: 34}, {x: 27.1, y: 38}, {x: 27.1, y: 42}, {x: 27.1, y: 46},
  {x: 27.1, y: 50}, {x: 27.1, y: 54}, {x: 27.1,  y: 58}, {x: 27.1, y: 62}, {x: 27.1, y: 66}, {x: 27.1, y: 70}, {x: 27.1, y: 74}, {x: 27.1, y: 78}, {x: 27.1, y: 82},

  {x: 91.3, y: 14}, {x: 91.3, y: 18}, {x: 91.3, y: 22}, {x: 91.3, y: 26}, {x: 91.3, y: 30}, {x: 91.3, y: 34}, {x: 91.3, y: 38}, {x: 91.3, y: 42}, {x: 91.3, y: 46},
  {x: 91.3, y: 50}, {x: 91.3, y: 54}, {x: 91.3, y: 58}, {x: 91.3, y: 62}, {x: 91.3, y: 66}, {x: 91.3, y: 70}, {x: 91.3, y: 74}, {x: 91.3, y: 78},

  {x: 89.1, y: 14}, {x: 87.3, y: 14}, {x: 85.5, y: 14}, {x: 83.7, y: 14}, {x: 81.7, y: 14},

  {x: 80.9, y: 18}, {x: 80.9, y: 22}, {x: 80.9, y: 26}, {x: 80.9, y: 30}, {x: 80.9, y: 34}, {x: 80.9, y: 38}, {x: 80.9, y: 42}, {x: 80.9, y: 46},
  {x: 80.9, y: 50}, {x: 80.9, y: 54}, {x: 80.9, y: 58}, {x: 80.9, y: 62}, {x: 80.9, y: 66}, {x: 80.9, y: 70}, {x: 80.9, y: 74}, {x: 80.9, y: 78}, {x: 80.9, y: 82},
  {x: 80.9, y: 86},

  {x: 39, y: 80}, {x: 42, y: 80}, {x: 45, y: 80}, {x: 48, y: 80}, {x: 51, y: 80},{x: 54, y: 80},
  {x: 57, y: 80}, {x: 60, y: 80}, {x: 63, y: 80},

  {x: 63, y: 86}, {x: 66, y: 86},{x: 69, y: 86},{x: 72, y: 86},{x: 75,y: 86}, {x: 78, y: 86}, 

  {x: 30, y: 16}, {x: 33, y: 16}, {x: 36, y: 16}, {x: 39, y: 16}, {x: 42, y: 16}, {x: 45, y: 16}, {x: 48, y: 16}, {x: 51, y: 16},{x: 54, y: 16},
  {x: 57, y: 16}, {x: 60, y: 16}, 


  {x: 60, y: 22},{x: 60, y: 28},

  {x: 39, y: 33},{x: 42, y: 33},{x: 45, y: 33},{x: 48, y: 33},{x: 51, y: 33},{x: 54, y: 33},{x: 57, y: 33},{x: 60, y: 33},
  
  {x: 39, y: 39},{x: 39, y: 45},{x: 39, y: 49},
  
  {x: 42, y: 49},{x: 45, y: 49},{x: 48, y: 49},{x: 51, y: 49},{x: 54, y: 49},{x: 57, y: 49},{x: 60, y: 49},

  {x: 60, y: 55},{x: 60, y: 61},
  
  {x: 39, y: 65},{x: 42, y: 65},{x: 45, y: 65},{x: 48, y: 65},{x: 51, y: 65},{x: 54, y: 65},{x: 57, y: 65},{x: 60, y: 65},

  {x: 39, y: 71},{x: 39, y: 77},
];

/* ============================================================
   ğŸŸ¡ ì™•ì½”ì¸ â€” 7ê°œ
============================================================ */
const bigCoinPositions = [
  {x: 7.2, y: 82},
  {x: 26.8, y: 12},
  {x: 62.2, y: 83.9},
  {x: 90.4, y: 82}
];

/* ============================================================
   ğŸ’ ì½”ì¸ ìƒì„± (ì „ë¶€ í‘œì‹œ)
============================================================ */
const coins = [];
coinPositions.forEach(pos => {
  const coin = document.createElement("div");
  coin.classList.add("coin");
  coin.style.left = pos.x + "%";
  coin.style.top  = pos.y + "%";
  stage.appendChild(coin);
  coins.push(coin);
});

// ì™•ì½”ì¸ ìƒì„±
const bigCoins = [];
bigCoinPositions.forEach(pos => {
  const bigCoin = document.createElement("div");
  bigCoin.classList.add("big-coin");
  bigCoin.style.left = pos.x + "%";
  bigCoin.style.top  = pos.y + "%";
  stage.appendChild(bigCoin);
  bigCoins.push(bigCoin);
});

/* ============================================================
   âŒ¨ï¸ ì´ë™ + ê²½ê³„ ì œí•œ + ë²½ ì¶©ëŒ + ğŸ’¥íŠ•ê¹€ ë°˜ë™ ì ìš©
============================================================ */
window.addEventListener("keydown", e => {
  // ğŸµ ì²« í‚¤ ì…ë ¥ ì‹œ ë°°ê²½ìŒ ì‹œì‘
if (!bgmStarted) {
  bgmStarted = true;
  bgm1.currentTime = 0;
  bgm1.play().catch(()=>{});  // í¬ë¡¬ ìë™ì¬ìƒ ìš°íšŒ
}

  // í™”ì‚´í‘œ ìŠ¤í¬ë¡¤ ë°©ì§€
  if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)) e.preventDefault();

  const rect    = limit.getBoundingClientRect();     // limit-area ì¢Œí‘œ
  const pRect0  = pacman.getBoundingClientRect();    // í˜„ì¬ íŒ©ë§¨ í¬ê¸°
  let nx = x;
  let ny = y;

  switch (e.key) {
    case "ArrowUp":
      ny -= speed;
      pacman.style.transform = "rotate(-90deg) scaleX(1)";
      break;

    case "ArrowDown":
      ny += speed;
      pacman.style.transform = "rotate(90deg) scaleX(1)";
      break;

    case "ArrowLeft":
      nx -= speed;
      pacman.style.transform = "rotate(0deg) scaleX(-1)";
      break;

    case "ArrowRight":
      nx += speed;
      pacman.style.transform = "rotate(0deg) scaleX(1)";
      break;

    default:
      return;
  }

  // í›„ë³´ ìœ„ì¹˜ë¥¼ ì¼ë‹¨ ì ìš©
  pacman.style.left = nx + "%";
  pacman.style.top  = ny + "%";

  // ğŸš« ë²½ ì¶©ëŒ ì‹œ ë°˜ë™ ì ìš©
  if (isColliding()) {
    const bouncePower = 0.25; // ğŸ’¥ íŠ•ê¹€ ê°•ë„ (0.2~0.3 ìì—°ìŠ¤ëŸ¬ì›€)
    nx = x;
    ny = y;

    // ì´ë™ ë°©í–¥ ë°˜ëŒ€ìª½ìœ¼ë¡œ ì‚´ì§ ë°€ì–´ëƒ„
    switch (e.key) {
      case "ArrowUp":    ny += bouncePower; break;
      case "ArrowDown":  ny -= bouncePower; break;
      case "ArrowLeft":  nx += bouncePower; break;
      case "ArrowRight": nx -= bouncePower; break;
    }

    pacman.style.left = nx + "%";
    pacman.style.top  = ny + "%";

    // ê·¸ë˜ë„ ë‹¿ì•„ìˆìœ¼ë©´ ì™„ì „ ë¡¤ë°±
    if (isColliding()) {
      nx = x;
      ny = y;
      pacman.style.left = x + "%";
      pacman.style.top  = y + "%";
    }
  }

  const limitRect = limit.getBoundingClientRect();
const pRectNow  = pacman.getBoundingClientRect();

if (
  pRectNow.left   >= limitRect.left &&
  pRectNow.right  <= limitRect.right &&
  pRectNow.top    >= limitRect.top &&
  pRectNow.bottom <= limitRect.bottom
) {
    x = nx;
    y = ny;

    positions.push({ x, y });
    checkCoinCollision();
    checkBigCoinCollision();
    checkStageComplete();
} else {
    pacman.style.left = x + "%";
    pacman.style.top  = y + "%";
}


});


/* ============================================================
   ğŸµ ì‚¬ìš´ë“œ í•¨ìˆ˜
============================================================ */
function playSmallCoinSound() {
  try { smallCoinSound.currentTime = 0; smallCoinSound.play(); } catch(e){}
}
function playBigCoinSound() {
  try { coinSound.currentTime = 0; coinSound.play(); } catch(e){}
}

/* ============================================================
   ğŸ¬ ì½”ì¸ ì¶©ëŒ ì‹œ
============================================================ */
function checkCoinCollision() {
  const pacRect = pacman.getBoundingClientRect();
  coins.forEach(c => {
    if (!c.dataset.hit) {
      const r = c.getBoundingClientRect();
      const overlap = !(
        pacRect.right < r.left ||
        pacRect.left > r.right ||
        pacRect.bottom < r.top ||
        pacRect.top > r.bottom
      );
      if (overlap) {
        c.dataset.hit = "1";
        c.style.transform = "scale(1.3)";
        c.style.opacity = "0";
        playSmallCoinSound(); // âœ… ì¼ë°˜ ì½”ì¸ ì†Œë¦¬ ì¬ìƒ
        setTimeout(() => c.remove(), 150);
      }
    }
  });
}

/* ============================================================
   ğŸ‘‘ ì™•ì½”ì¸ ì¶©ëŒ ì‹œ
============================================================ */
let bigCoinCount = 0;
function checkBigCoinCollision() {
  const pacRect = pacman.getBoundingClientRect();
  bigCoins.forEach(c => {
    if (!c.dataset.hit) {
      const r = c.getBoundingClientRect();
      const overlap = !(
        pacRect.right < r.left ||
        pacRect.left > r.right ||
        pacRect.bottom < r.top ||
        pacRect.top > r.bottom
      );
      if (overlap) {
        c.dataset.hit = "1";
        c.style.transform = "scale(1.3)";
        c.style.opacity = "0";
        playBigCoinSound(); // âœ… ì™•ì½”ì¸ ì†Œë¦¬ ì¬ìƒ
        setTimeout(() => c.remove(), 150);
        bigCoinCount++;
      }
    }
  });
}

/* ============================================================
   ğŸŠ ìŠ¤í…Œì´ì§€ ì™„ë£Œ ì²´í¬ & í‘œì‹œ
============================================================ */
function remainingCoinsCount() {
  return document.querySelectorAll('.coin:not([data-hit])').length;
}
function remainingBigCoinsCount() {
  return document.querySelectorAll('.big-coin:not([data-hit])').length;
}
function checkStageComplete() {
  if (remainingCoinsCount() === 0 && remainingBigCoinsCount() === 0) {
    // ğŸ›¡ï¸ Evil ë¬´ë ¥í™” ì¦‰ì‹œ ë°œë™
    canBeCaught = false;
    evilActive = false;
    evilPacman.style.filter = "grayscale(100%) brightness(0.4)";
    showStageComplete();
  }
}

function showStageComplete() {
  const text = document.getElementById("stageCompleteText");

  // ğŸ§© Evil ë¬´ë ¥í™”
  canBeCaught = false;
  evilActive = false;
  if (typeof evilPacman !== "undefined") {
    evilPacman.style.filter = "grayscale(100%) brightness(0.4)";
  }

  // ğŸ¨ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼
  Object.assign(text.style, {
    display: "block",
    opacity: "1",
    color: "#8B0000", // ì–´ë‘ìš´ ë¶‰ì€ìƒ‰
    fontSize: "1.6vw",
    fontFamily: "DungGeunMo, monospace",
    textShadow: "none",
    whiteSpace: "pre",
    position: "fixed",
    left: "50%",
    top: "50%", // í™”ë©´ ì¤‘ì•™ë³´ë‹¤ ì‚´ì§ ì•„ë˜
    transform: "translate(-50%, -50%)",
    margin: "0",
    padding: "0",
    background: "none",
    lineHeight: "1.3",
    width: "100vw",
    height: "100vh",
    overflow: "hidden",
    textAlign: "left",
  });

  const randomChars =
    "ì•ˆë¼ì•ˆë¼ì•ˆë¼ì•ˆë¼ì•ˆë¼ì•ˆë¼ì•ˆë¼ì•ˆë¼ì•ˆë¼ì•ˆë¼ì•ˆë¼ì•ˆë¼ì•ˆë¼";
  const powerNoise = new Audio("./ì „ì›ë…¸ì´ì¦ˆ.mp3");
  powerNoise.volume = 0.4;

  function makeRandomLine() {
    const len = Math.floor(Math.random() * 120) + 90;
    let line = "";
    for (let i = 0; i < len; i++) {
      line += randomChars[Math.floor(Math.random() * randomChars.length)];
    }
    return line;
  }

  // âš¡ ë”± í•œ ì¤„ì”© "ì¶”ê°€"ë§Œ í•¨ â€” ê¸°ì¡´ ë‚´ìš©ì€ ìœ ì§€
  let count = 0;
  let messageShown = false;

  function typeScroll() {
    let line;
    if (!messageShown && count > 15 && Math.random() < 0.05) {
      line = "ë„ˆë„ ì—¬ê¸° ê°€ë‘˜ ìˆ˜ ìˆì—ˆëŠ”ë°.";
      messageShown = true;
      powerNoise.play().catch(() => {});
    } else {
      line = makeRandomLine();
    }

    // âœ… ê¸°ì¡´ í…ìŠ¤íŠ¸ëŠ” ìœ ì§€í•˜ê³ , ìƒˆ ì¤„ë§Œ ì¶”ê°€
    text.innerText += line + "\n";

    // âœ… ì•„ë˜ë¡œ ì‚´ì§ ìŠ¤í¬ë¡¤ (ë¶€ë“œëŸ½ì§€ ì•Šê²Œ ì¦‰ì‹œ ì´ë™)
    text.scrollTop = text.scrollHeight;

    count++;
    setTimeout(typeScroll, 45 + Math.random() * 40); // ì¼ì •í•œ íƒ€ì´í•‘ ì†ë„
  }

  typeScroll();
}


/* ============================================================
   ğŸš« ë²½ ì¶©ëŒ ê°ì§€ í•¨ìˆ˜ (íšŒì „ ëŒ€ì‘ í¬í•¨)
============================================================ */
function isColliding() {
  const pRect = pacman.getBoundingClientRect();

  // ğŸ¯ íŒ©ë§¨ ì¤‘ì‹¬ ì¢Œí‘œ ê³„ì‚°
  const px = pRect.left + pRect.width / 2;
  const py = pRect.top  + pRect.height / 2;
  const radius = pRect.width * 0.4; // íŒ©ë§¨ ë°˜ê²½

  const walls = document.querySelectorAll(".wall");

  for (let w of walls) {
    const rect = w.getBoundingClientRect();
    const style = window.getComputedStyle(w);
    const transform = style.transform;

    // ğŸ“ íšŒì „ëœ ë²½ ê°ë„ ì¶”ì¶œ
    let angle = 0;
    if (transform !== "none" && transform.includes("matrix")) {
      const values = transform.match(/matrix\(([^)]+)\)/)[1].split(",");
      const a = parseFloat(values[0]);
      const b = parseFloat(values[1]);
      angle = Math.atan2(b, a); // ë¼ë””ì•ˆ
    }

    // ğŸ§® ë²½ ì¤‘ì‹¬ ë° ì ˆë°˜ í¬ê¸°
    const cx = rect.left + rect.width  / 2;
    const cy = rect.top  + rect.height / 2;
    const halfW = rect.width  / 2;
    const halfH = rect.height / 2;

    // íŒ©ë§¨ ì¢Œí‘œë¥¼ ë²½ ì¢Œí‘œê³„ë¡œ íšŒì „ ë³€í™˜
    const dx = px - cx;
    const dy = py - cy;
    const rotatedX = dx * Math.cos(-angle) - dy * Math.sin(-angle);
    const rotatedY = dx * Math.sin(-angle) + dy * Math.cos(-angle);

    // ğŸ¯ ì‹¤ì œ ì¶©ëŒ íŒì • (ì—¬ìœ  0.3 * radius)
    const hitX = Math.abs(rotatedX) <= halfW + radius * 0.6;
    const hitY = Math.abs(rotatedY) <= halfH + radius * 0.6;
    if (hitX && hitY) return true;
  }

  return false;
}



/* ============================================================
   ğŸ” ë°˜ì‘í˜• ì½”ì¸ ìœ„ì¹˜ ì¬ê³„ì‚° (ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘)
============================================================ */
function repositionCoins() {
  coins.forEach((coin, i) => {
    const pos = coinPositions[i];
    if (!coin.dataset.hit) {
      coin.style.left = pos.x + "%";
      coin.style.top  = pos.y + "%";
    }
  });
  // ì™•ì½”ì¸ì€ ì¢Œí‘œ ê³ ì • (ì œê±°ëœ ê±´ ê·¸ëŒ€ë¡œ ì‚­ì œ ìƒíƒœ)
}
window.addEventListener("resize", repositionCoins);


function triggerJumpscare() {
  bgm1.pause();
  bgm2.currentTime = 0;
  bgm2.play().catch(()=>{});
  const overlay = document.getElementById("jumpscareOverlay");
  const scream  = document.getElementById("screamSound");

  // ğŸ¬ 1ï¸âƒ£ íŒ©ë§¨ ê°ì„± PNG
  const imgPath = "./íŒ©ë§¨ ê°ì„±.png";
  overlay.style.backgroundImage = `url('${imgPath}')`;
  overlay.style.display = "block";
  overlay.style.opacity = "0";

  const showAnim = overlay.animate(
    [
      { opacity: 0, filter: "brightness(0.3) blur(0.5vw)" },
      { opacity: 1, filter: "brightness(2) blur(0vw)" },
      { opacity: 1, filter: "brightness(1.5)" }
    ],
    { duration: 300, fill: "forwards", easing: "ease-in" }
  );

  // ê´´ì„± ì¬ìƒ
  showAnim.onfinish = () => {
    try {
      scream.currentTime = 0;
      scream.play().catch(()=>{});
    } catch(e) {}
  };

  // ğŸ¥ 2ï¸âƒ£ PNG ì œê±° í›„ ì˜ìƒ ì‹œì‘
  setTimeout(() => {
    overlay.style.display = "none";
    overlay.remove();   // ğŸ”¥ ì´ í•œ ì¤„ ì¶”ê°€í•˜ë©´ ë°”ë¡œ í•´ê²°

    const video = document.createElement("video");
    video.src = "./íŒ©ë§¨ í€˜ìŠ¤íŠ¸ 2.mp4";

    video.style.position = "fixed";
    video.style.top = "0";
    video.style.left = "0";
    video.style.width = "100vw";
    video.style.height = "100vh";
    video.style.objectFit = "cover";
    video.style.zIndex = "10000";
    video.autoplay = true;
    video.muted = false;
    video.playsInline = true;
    document.body.appendChild(video);

    // ğŸï¸ 3ï¸âƒ£ ì˜ìƒ ëë‚˜ë©´ Evil ë“±ì¥ + ì¶”ê²© ì‹œì‘
    video.addEventListener("ended", () => {
      video.remove();

      evilPacman.style.left = "9.2vw";
      evilPacman.style.top  = "78vh";
      evilPacman.style.display = "block";
      evilPacman.style.opacity = "1";

      startRecordingPath();
      startEvilFollow(1000, 0.3);

      // â¸ï¸ 4ï¸âƒ£ Evil ë“±ì¥ 2ì´ˆ ë’¤, í™”ë©´ ì¼ì‹œì •ì§€ + ê²½ê³ ë¬¸ í‘œì‹œ
      setTimeout(() => showMidWarning(), 2000);
    });
  }, 1200);
}

/* ============================================================
   âš ï¸ ì¤‘ê°„ ê²½ê³ ë¬¸ í‘œì‹œ í•¨ìˆ˜ (3ì´ˆ ìœ ì§€ + ì‚¬ìš´ë“œ)
============================================================ */
function showMidWarning() {
  evilActive = false; // Evil ì¼ì‹œ ì •ì§€

  // ğŸ“¢ ì‚¬ìš´ë“œ ì¬ìƒ
  const warningSound = new Audio("./ìœˆë„ìš°-ì†¡.mp3");
  warningSound.currentTime = 0;
  warningSound.play().catch(()=>{});

  // ğŸ§Š í™”ë©´ ì˜¤ë²„ë ˆì´ ìƒì„±
  const freezeOverlay = document.createElement("div");
  freezeOverlay.style.position = "fixed";
  freezeOverlay.style.top = "0";
  freezeOverlay.style.left = "0";
  freezeOverlay.style.width = "100vw";
  freezeOverlay.style.height = "100vh";
  freezeOverlay.style.background = "rgba(0, 0, 0, 0.55)"; // ğŸ”¹ ë„ˆë¬´ ì–´ë‘¡ì§€ ì•Šê²Œ ì¡°ì • (ê¸°ì¡´ 0.8 â†’ 0.55)
  freezeOverlay.style.zIndex = "10001";
  freezeOverlay.style.display = "flex";
  freezeOverlay.style.justifyContent = "center";
  freezeOverlay.style.alignItems = "center";

  // âš ï¸ ê²½ê³  ì´ë¯¸ì§€ í‘œì‹œ
  const warningImg = document.createElement("img");
  warningImg.src = "./íŒ©ë§¨-ì¤‘ê°„-ê²½ê³ ë¬¸.png";
  warningImg.style.width = "60vw";
  warningImg.style.height = "auto";
  warningImg.style.imageRendering = "pixelated";
  warningImg.style.filter = "none"; // ğŸ”¥ ë°ê¸° ì œê±° (ê¸°ì¡´ brightness(1.2) ì‚­ì œ)
  freezeOverlay.appendChild(warningImg);
  document.body.appendChild(freezeOverlay);

  // 3ì´ˆ í›„ ì œê±° + Evil ì¬ì‹œì‘
  setTimeout(() => {
    freezeOverlay.remove();
    evilActive = true;
    startEvilFollow(500, 0.3);
  }, 3000);
}


// ğŸ”Š ì˜¤ë””ì˜¤ ìë™ì¬ìƒ ì •ì±… ìš°íšŒ: ì²« ì…ë ¥ ë•Œ ë¯¸ë¦¬ unlock
function unlockAudioOnce() {
  const s = document.getElementById("screamSound");
  s.muted = true;
  s.play().then(() => { s.pause(); s.muted = false; }).catch(()=>{});
  window.removeEventListener("pointerdown", unlockAudioOnce);
  window.removeEventListener("keydown", unlockAudioOnce);
}
window.addEventListener("pointerdown", unlockAudioOnce, { once:true });
window.addEventListener("keydown", unlockAudioOnce,   { once:true });

// â±ï¸ í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹œì‘
window.addEventListener("load", () => {
  bgm1.currentTime = 0;
  bgm1.play().catch(()=>{});
  startRecordingPath();  // âœ… íŒ©ë§¨ì´ ë©ˆì¶°ìˆì–´ë„ ê²½ë¡œë¥¼ ê³„ì† ê¸°ë¡í•˜ë„ë¡ ì¶”ê°€
  setTimeout(triggerJumpscare, 10000); // 10ì´ˆ ë’¤ ê°ì„±
});

function startRecordingPath(){
  if (recordTimer) return;
  recordTimer = setInterval(()=>{
    positions.push({ x, y });          // í˜„ì¬ íŒ©ë§¨ ìœ„ì¹˜ë¥¼ ê³„ì† ê¸°ë¡
    if (positions.length > 2000) {
      positions.splice(0, positions.length - 2000); // ì˜¤ë˜ëœ ê±´ ì •ë¦¬
    }
  }, 60); // 60msë§ˆë‹¤ ê¸°ë¡ (â‰ˆ16~17fps)
}
function startEvilFollow(delayMs = 150, speed = 0.28) {
  evilActive = true;
  evilPacman.style.display = "block";

  const bufferCount = Math.max(10, Math.round(delayMs / 16));

  function animate() {
    if (!evilActive) return;

    if (positions.length > bufferCount) {
      const target = positions.shift();
      const currX = parseFloat(evilPacman.style.left) || target.x;
      const currY = parseFloat(evilPacman.style.top) || target.y;

      // ğŸ’¨ ë¶€ë“œëŸ½ê²Œ ì´ë™ (Lerp)
let newX = currX + (target.x - currX) * speed;
let newY = currY + (target.y - currY) * speed;

// ğŸš« ë²½ ì¶©ëŒ ê²€ì‚¬
evilPacman.style.left = newX + "%";
evilPacman.style.top  = newY + "%";

if (isCollidingEvil()) {
  // ğŸ‘‰ ë¶€ë”ªíˆë©´ í†µê³¼ëŠ” ë§‰ë˜, ì•½ê°„ ë¹„ê»´ ì›€ì§ì´ê¸°
  // ë²½ì— ë‹¿ì•˜ì„ ë•Œ ë¯¸ì„¸í•˜ê²Œ ë°€ë ¤ë‚˜ë©° ëŒì•„ê°€ë„ë¡ ì¡°ì •
  const dx = target.x - currX;
  const dy = target.y - currY;
  const sideStep = 0.4; // ğŸ’« íšŒí”¼ ê°•ë„ (ê°’ ë†’ì´ë©´ ë” ë¯¸ë„ëŸ¬ì§)

  // ìˆ˜í‰ìœ¼ë¡œ ë§‰í˜”ì„ ë•Œ â†’ ìˆ˜ì§ìœ¼ë¡œ ì•½ê°„ ì´ë™
  if (Math.abs(dx) > Math.abs(dy)) {
    newY += (Math.random() > 0.5 ? sideStep : -sideStep);
  }
  // ìˆ˜ì§ìœ¼ë¡œ ë§‰í˜”ì„ ë•Œ â†’ ìˆ˜í‰ìœ¼ë¡œ ì•½ê°„ ì´ë™
  else {
    newX += (Math.random() > 0.5 ? sideStep : -sideStep);
  }

  evilPacman.style.left = newX + "%";
  evilPacman.style.top  = newY + "%";
}


      // ğŸ¯ ë°©í–¥ íšŒì „ (íŒ©ë§¨ì²˜ëŸ¼)
      const dx = target.x - currX;
      const dy = target.y - currY;
      if (Math.abs(dx) > Math.abs(dy)) {
        evilPacman.style.transform = dx < 0 ? "scaleX(-1)" : "scaleX(1)";
      } else {
        evilPacman.style.transform = dy < 0 ? "rotate(-90deg)" : "rotate(90deg)";
      }

      // ğŸ’¥ ì¶©ëŒ ì‹œ
      if (checkEvilCollision()) handleCaught();
    }
    requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
}

/* ============================================================
   ğŸ’¥ evilPacmanì´ íŒ©ë§¨ì„ ì¡ì•˜ì„ ë•Œ
============================================================ */
function checkEvilCollision() {
  const pacRect = pacman.getBoundingClientRect();
  const evilRect = evilPacman.getBoundingClientRect();
  return !(
    pacRect.right < evilRect.left ||
    pacRect.left > evilRect.right ||
    pacRect.bottom < evilRect.top ||
    pacRect.top > evilRect.bottom
  );
}

function handleCaught() {
  if (!evilActive) return;
  evilActive = false;

  const flash = document.createElement("div");
  flash.style.position = "fixed";
  flash.style.inset = "0";
  flash.style.background = "rgba(255, 0, 0, 0.35)";
  flash.style.zIndex = "998999";
  flash.style.animation = "redFlash 0.25s ease-in-out 4 alternate";
  document.body.appendChild(flash);

  const scream = document.getElementById("screamSound");
  scream.pause();
  scream.currentTime = 0;
  scream.play().catch(()=>{});

  setTimeout(() => {
    triggerJumpscare();
  }, 1500);

  // ğŸ’€ 3ì´ˆ í›„ í˜ì´ì§€ ì™„ì „ ìƒˆë¡œê³ ì¹¨ (ì²˜ìŒ ìƒíƒœë¡œ ëŒì•„ê°)
  setTimeout(() => {
    flash.remove();
    location.reload(); // âœ… ì´ê±° í•˜ë‚˜ë©´ ë
  }, 3000);
}




/* ë¶‰ì€ ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ */
const style = document.createElement('style');
style.innerHTML = `
@keyframes redFlash {
  0% { opacity: 0; filter: brightness(1); }
  100% { opacity: 1; filter: brightness(2); }
}`;
document.head.appendChild(style);


function isCollidingEvil() {
  const pRect = evilPacman.getBoundingClientRect();
  const px = pRect.left + pRect.width / 2;
  const py = pRect.top + pRect.height / 2;
  const radius = pRect.width * 0.4;

  const walls = document.querySelectorAll(".wall");

  for (let w of walls) {
    const rect = w.getBoundingClientRect();
    const style = window.getComputedStyle(w);
    const transform = style.transform;

    let angle = 0;
    if (transform !== "none" && transform.includes("matrix")) {
      const values = transform.match(/matrix\(([^)]+)\)/)[1].split(",");
      const a = parseFloat(values[0]);
      const b = parseFloat(values[1]);
      angle = Math.atan2(b, a);
    }

    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;
    const halfW = rect.width / 2;
    const halfH = rect.height / 2;

    const dx = px - cx;
    const dy = py - cy;
    const rotatedX = dx * Math.cos(-angle) - dy * Math.sin(-angle);
    const rotatedY = dx * Math.sin(-angle) + dy * Math.cos(-angle);

    const hitX = Math.abs(rotatedX) <= halfW + radius * 0.3;
    const hitY = Math.abs(rotatedY) <= halfH + radius * 0.3;
    if (hitX && hitY) return true;
  }
  return false;
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì ìš©
window.addEventListener("load", () => {
  expandWalls(0.6, 0.6); // ğŸ‘‰ 0.3~0.6 ë²”ìœ„ì—ì„œ ì¡°ì ˆ ê°€ëŠ¥
});



</script>
</body>
</html>