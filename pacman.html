<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Noah Pacman â€” Limit + Wall Collision + All Coins + Big Coins + Sound + Stage Complete</title>
<link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2107@1.0/DungGeunMo.css" rel="stylesheet">
<style>
  /* ============================================================
     ğŸŒ‘ ê¸°ë³¸ ì„¸íŒ…
     ============================================================ */
  html, body {
    margin: 0;
    padding: 0;
    width: 100vw;
    height: 100vh;
    background: black;
    overflow: hidden;
  }
  .stage {
    position: relative;
    width: 100vw;
    height: 100vh;
  }
  .background {
    position: absolute;
    width: 100%;
    height: 100%;
    background: url('./íŒ©ë§¨-ìˆ˜ì •.png') center/contain no-repeat;
    z-index: 0;
  }

  /* ============================================================
     ğŸ¬ ì½”ì¸ (ì‘ì€ ì½”ì¸) - ì´ë¯¸ì§€ + íšŒì „
     ============================================================ */
  .coin {
    position: absolute;
    width: 0.9vw;
    height: 0.9vw;
    background: url('./ì½”ì¸.png') center/contain no-repeat;
    background-size: 100% auto;
    image-rendering: pixelated;
    z-index: 2;
    transition: opacity 0.15s ease, transform 0.15s ease;
    animation: coinSpin 2s linear infinite;
  }
  @keyframes coinSpin {
    0% { transform: rotateY(0deg); }
    50% { transform: rotateY(180deg) scale(1.1); filter: brightness(1.4); }
    100% { transform: rotateY(360deg); }
  }

  /* ============================================================
     ğŸ‘‘ ì™•ì½”ì¸ - ì´ë¯¸ì§€ + ë°˜ì§ íšŒì „
     ============================================================ */
  .big-coin {
    position: absolute;
    width: 2.5vw;
    height: 2.5vw;
    background: url('./ì™•ì½”ì¸.png') center/contain no-repeat;
    image-rendering: pixelated;
    z-index: 4;
    animation: bigSpin 2s linear infinite;
    filter: drop-shadow(0 0 0.3vw gold);
  }
  @keyframes bigSpin {
    0% { transform: rotateY(0deg); filter: brightness(1) drop-shadow(0 0 0.3vw gold); }
    50% { transform: rotateY(180deg); filter: brightness(1.6) drop-shadow(0 0 0.6vw gold); }
    100% { transform: rotateY(360deg); filter: brightness(1) drop-shadow(0 0 0.3vw gold); }
  }

  /* ============================================================
     ğŸ˜‹ íŒ©ë§¨
     ============================================================ */
  .pacman {
  position: absolute;
  width: 5.2vw;             /* ğŸ”¹ ì•½ê°„ í¬ê²Œ ì¡°ì • ê°€ëŠ¥ */
  height: auto;
  background: none;
  image-rendering: pixelated;
  z-index: 5;
  transition: transform 0.05s linear;
}
.pacman img {
  width: 100%;
  height: auto;
  display: block;
  image-rendering: pixelated;
}


  /* ============================================================
     ğŸŸ© ì´ë™ ì œí•œ ê²½ê³„ (limit-area)
     ============================================================ */
  .limit-area {
    position: absolute;
    top: 5.5vw;
    left: 11vh;          /* ì›ë³¸ ê°’ ìœ ì§€ */
    width: 87.5vw;       /* ì´ë™ ê°€ëŠ¥ ê°€ë¡œ */
    height: 79.5vh;      /* ì´ë™ ê°€ëŠ¥ ì„¸ë¡œ */
    border: 0.3vh dashed rgba(0, 255, 64, 0); /* ë””ë²„ê¹… ì‹œ ë¶ˆíˆ¬ëª…ë„ë¡œ í™•ì¸ */
    z-index: 2;
    pointer-events: none;
  }

  /* ============================================================
     ğŸš« ë‚´ë¶€ ì¥ì• ë¬¼ ë²½ (íˆ¬ëª…) - ì¶©ëŒë§Œ
     ============================================================ */
  .wall {
    position: absolute;
    border: 0.3vh dashed rgba(0, 255, 64, 0); /* í•„ìš” ì‹œ 0.6 ë“±ìœ¼ë¡œ í™•ì¸ */
    z-index: 3;
    pointer-events: none;
    opacity: 0; /* ì™„ì „ ìˆ¨ê¹€ */
  }

  /* ============================================================
     ğŸ‰ ìŠ¤í…Œì´ì§€ ì™„ë£Œ ë¬¸êµ¬
     ============================================================ */
  .stage-complete {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'DungGeunMo', monospace;  /* ğŸ’¾ í”½ì…€í°íŠ¸ */
    font-size: 4vw;
    color: #00fff2;
    text-shadow:
      0 0 0.4vw #00ffff,
      0 0 0.8vw #00e0ff,
      0 0 1.6vw #0099ff,
      0 0 2.4vw #0066ff;
    letter-spacing: 0.1em;
    text-align: center;
    display: none;
    z-index: 20;
    animation: stageBlink 1s infinite alternate;
  }
  @keyframes stageBlink {
    from {
      filter: brightness(1);
      transform: translate(-50%, -50%) scale(1);
    }
    to {
      filter: brightness(1.8);
      transform: translate(-50%, -50%) scale(1.05);
    }
  }

  /* ğŸ”² ì–´ë‘ìš´ ë°°ê²½ (ì „ì²´ í™”ë©´ ë®ê¸°) */
.warning-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.85);
  z-index: 9999;
  backdrop-filter: blur(0.3vw);
}

/* âš ï¸ ê²½ê³ ì°½ (ì´ë¯¸ì§€ë§Œ ì‘ê²Œ ì¤‘ì•™ì— í‘œì‹œ) */
.warning-window {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 70vw;       /* âœ… íŒì—…ì°½ í¬ê¸°ë§Œ ì¡°ì ˆ */
  height: 55vh;
  transform: translate(-50%, -50%);
  background: center / contain no-repeat;
  image-rendering: pixelated;
  animation: warningGlitch 0.15s steps(2, start) infinite;
}

@keyframes warningGlitch {
  0% { transform: translate(-50%, -50%) scale(1); filter: brightness(1); }
  50% { transform: translate(calc(-50% + 0.3vw), calc(-50% - 0.3vh)) scale(1.02); filter: brightness(1.4) contrast(1.3); }
  100% { transform: translate(-50%, -50%) scale(1); filter: brightness(1); }
}

.video-overlay {
  display: none;
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  background: black;
  z-index: 999999;
}

.video-overlay video {
  width: 100%;
  height: 100%;
  object-fit: cover; /* âœ… í™”ë©´ ê½‰ ì±„ì›Œì„œ ë³´ì´ê²Œ */
  display: block;    /* âœ… ë¸Œë¼ìš°ì € ë Œë”ë§ ë²„ê·¸ ë°©ì§€ */
  background: black; /* âœ… ê¹œë°•ì„ ë°©ì§€ */
}


</style>
</head>

<body>
  
<!-- âš ï¸ ê²½ê³  ë°°ê²½ + ê²½ê³  ì´ë¯¸ì§€ ë¶„ë¦¬ -->
<div class="warning-overlay" id="warningOverlay">
  <div class="warning-window" id="warningWindow"></div>
</div>


  <div class="stage" id="stage">
    <div class="background"></div>
    <div class="limit-area" id="limit"></div> <!-- ì´ë™ ì œí•œ ê²½ê³„ -->

    <!-- =======================
         ğŸ”’ ë³´ì´ì§€ ì•ŠëŠ” ë²½ (ì¶©ëŒë§Œ)
         ======================= -->
    <div class="wall" style="top: 19.7vh; left: 12.9vw; width: 4.1vw; height: 69.8vh;"></div>
    <div class="wall" style="top: 19.7vh; left: 82.7vw; width: 4.1vw; height: 69.8vh;"></div>

    <div class="wall" style="top: 10vh; left: 21.6vw; width: 4.1vw; height: 69.8vh;"></div>
    <div class="wall" style="top: 10vh; left: 74vw; width: 4.1vw; height: 69.8vh;"></div>

    <div class="wall" style="top: 86vh; left: 29.7vw; width: 40.3vw; height: 3.2vh;"></div>
    <div class="wall" style="top: 10.3vh; left: 29.7vw; width: 40.3vw; height: 3.2vh;"></div>

    <div class="wall" style="top: 36.5vh; left: 39.3vw; width: 21.1vw; height: 9vh;"></div>
    <div class="wall" style="top: 46vh; left: 39.3vw; width: 5.2vw; height: 17vh;"></div>
    <div class="wall" style="top: 46vh; left: 55.2vw; width: 5.2vw; height: 17vh;"></div>

    <div class="wall" style="top: 20.2vh; left: 31.2vw; width: 37.3vw; height: 7.3vh;"></div>
    <div class="wall" style="top: 71.8vh; left: 31.2vw; width: 37.3vw; height: 7.3vh;"></div>

    <div class="wall" style="top: 58.3vh; left: 31.2vw; width: 4vw; height: 12vh;"></div>
    <div class="wall" style="top: 58.3vh; left: 64.5vw; width: 4vw; height: 12vh;"></div>

    <div class="wall" style="top: 29.3vh; left: 31.2vw; width: 4vw; height: 12vh;"></div>
    <div class="wall" style="top: 29.3vh; left: 64.5vw; width: 4vw; height: 12vh;"></div>

    <!-- íŒ©ë§¨ -->
    <div class="pacman" id="pacman">
  <img src="./íŒ©ë§¨.gif" alt="Pacman">
</div>


  <!-- ğŸ‰ ìŠ¤í…Œì´ì§€ ì™„ë£Œ ë¬¸êµ¬ -->
  <div class="stage-complete" id="stageCompleteText">STAGE ONE CLEAR!</div>

  <!-- ğŸµ ì½”ì¸ ì†Œë¦¬ -->
  <audio id="coinSound" src="ì½”ì¸ì†Œë¦¬.mp3" preload="auto"></audio>
  <audio id="smallCoinSound" src="ì‘ì€ì½”ì¸.mp3" preload="auto"></audio>
  <audio id="bgMusic" src="./íŒ©ë§¨ ë°°ê²½ìŒ.mp3" preload="auto" loop></audio>
  <audio id="successSound" src="./ì„±ê³µ ìŒí–¥.mp3" preload="auto"></audio>

<!-- ğŸ¬ ì˜ìƒ ì˜¤ë²„ë ˆì´ -->
<div class="video-overlay" id="videoOverlay" style="display:none;">
  <video id="surviveVideo" src="./íŒ©ë§¨ ì‚´ì•„ë‚¨ì„ë•Œê¹Œì§€ 1.mp4"></video>
</div>


  <!-- ğŸµ íš¨ê³¼ìŒ -->
<audio id="errorSound" src="./ìœˆë„ìš°-ì†¡.mp3" preload="auto"></audio>

<!-- âš ï¸ ê²½ê³  ì´ë¯¸ì§€ -->
<div class="warning-screen" id="warningScreen"></div>
<script>
/* ============================================================
   ğŸ® Noah Pacman â€” â€œë¹¨ê°„ ë„¤ëª¨ ì•ˆ + ë²½ ì¶©ëŒ + ëª¨ë“  ì½”ì¸ + ì™•ì½”ì¸ + ì†Œë¦¬ + ì™„ë£Œë¬¸êµ¬â€
============================================================ */
const stage = document.getElementById("stage");
const pacman = document.getElementById("pacman");
const limit  = document.getElementById("limit");
const coinSound = document.getElementById("coinSound");
const smallCoinSound = document.getElementById("smallCoinSound"); // ì¼ë°˜ ì½”ì¸ ì†Œë¦¬

let x = 9.2; // íŒ©ë§¨ ì‹œì‘ X (vw)
let y = 78; // íŒ©ë§¨ ì‹œì‘ Y (vh)
const speed = 1; // ì´ë™ ì†ë„ (vw/vh ë‹¨ìœ„ ê°œë…ì ìœ¼ë¡œ ì¼ì¹˜)

pacman.style.left = x + "vw";
pacman.style.top  = y + "vh";

/* ============================================================
   ğŸ¬ ì½”ì¸ ì¢Œí‘œ (ì „ë¶€ ìœ ì§€, ìƒëµ ì—†ìŒ)
============================================================ */
const coinPositions = [
  // ë§¨ì™¼ìª½ ì¤„
  {x: 9.2, y: 14}, {x: 9.2, y: 18}, {x: 9.2, y: 22}, {x: 9.2, y: 26}, {x: 9.2, y: 30}, {x: 9.2, y: 34}, {x: 9.2, y: 38}, {x: 9.2, y: 42}, {x: 9.2, y: 46},
  {x: 9.2, y: 50}, {x: 9.2, y: 54}, {x: 9.2, y: 58}, {x: 9.2, y: 62}, {x: 9.2, y: 66}, {x: 9.2, y: 70}, {x: 9.2, y: 74}, {x: 9.2, y: 78},

  {x: 10.2, y: 14}, {x: 12, y: 14}, {x: 13.8, y: 14}, {x: 15.6, y: 14}, {x: 17.4, y: 14}, {x: 19.2, y: 14},

  {x: 19.2, y: 18}, {x: 19.2, y: 22}, {x: 19.2, y: 26}, {x: 19.2, y: 30}, {x: 19.2, y: 34}, {x: 19.2, y: 38}, {x: 19.2, y: 42}, {x: 19.2, y: 46},
  {x: 19.2, y: 50}, {x: 19.2, y: 54}, {x: 19.2, y: 58}, {x: 19.2, y: 62}, {x: 19.2, y: 66}, {x: 19.2, y: 70}, {x: 19.2, y: 74}, {x: 19.2, y: 78}, {x: 19.2, y: 82},
  {x: 19.2, y: 86},

  {x: 20.2, y: 86}, {x: 22, y: 86}, {x: 23.8, y: 86}, {x: 25.6, y: 86}, {x: 27.5, y: 86},

  {x: 27.6, y: 18}, {x: 27.6, y: 22}, {x: 27.6, y: 26}, {x: 27.6, y: 30}, {x: 27.6, y: 34}, {x: 27.6, y: 38}, {x: 27.6, y: 42}, {x: 27.6, y: 46},
  {x: 27.6, y: 50}, {x: 27.6, y: 54}, {x: 27.6,  y: 58}, {x: 27.6, y: 62}, {x: 27.6, y: 66}, {x: 27.6, y: 70}, {x: 27.6, y: 74}, {x: 27.6, y: 78}, {x: 27.6, y: 82},

  {x: 90, y: 14}, {x: 90, y: 18}, {x: 90, y: 22}, {x: 90, y: 26}, {x: 90, y: 30}, {x: 90, y: 34}, {x: 90, y: 38}, {x: 90, y: 42}, {x: 90, y: 46},
  {x: 90, y: 50}, {x: 90, y: 54}, {x: 90, y: 58}, {x: 90, y: 62}, {x: 90, y: 66}, {x: 90, y: 70}, {x: 90, y: 74}, {x: 90, y: 78},

  {x: 88.8, y: 14}, {x: 87.6, y: 14}, {x: 85.8, y: 14}, {x: 84, y: 14}, {x: 82.2, y: 14}, {x: 80.4, y: 14},

  {x: 80.4, y: 18}, {x: 80.4, y: 22}, {x: 80.4, y: 26}, {x: 80.4, y: 30}, {x: 80.4, y: 34}, {x: 80.4, y: 38}, {x: 80.4, y: 42}, {x: 80.4, y: 46},
  {x: 80.4, y: 50}, {x: 80.4, y: 54}, {x: 80.4, y: 58}, {x: 80.4, y: 62}, {x: 80.4, y: 66}, {x: 80.4, y: 70}, {x: 80.4, y: 74}, {x: 80.4, y: 78}, {x: 80.4, y: 82},
  {x: 80.4, y: 86},

  {x: 79.4, y: 86}, {x: 77.6, y: 86}, {x: 75.8, y: 86}, {x: 74, y: 86}, {x: 71.8, y: 86},

  {x: 71.4, y: 18}, {x: 71.4, y: 22}, {x: 71.4, y: 26}, {x: 71.4, y: 30}, {x: 71.4, y: 34}, {x: 71.4, y: 38}, {x: 71.4, y: 42}, {x: 71.4, y: 46},
  {x: 71.4, y: 50}, {x: 71.4, y: 54}, {x: 71.4,  y: 58}, {x: 71.4, y: 62}, {x: 71.4, y: 66}, {x: 71.4, y: 70}, {x: 71.4, y: 74}, {x: 71.4, y: 78}, {x: 71.4, y: 82},

  {x: 30, y: 82}, {x: 33, y: 82}, {x: 36, y: 82}, {x: 39, y: 82}, {x: 42, y: 82}, {x: 45, y: 82}, {x: 48, y: 82}, {x: 51, y: 82},{x: 54, y: 82},
  {x: 57, y: 82}, {x: 60, y: 82}, {x: 63, y: 82}, {x: 66, y: 82}, {x: 69, y: 82},

  {x: 30, y: 16}, {x: 33, y: 16}, {x: 36, y: 16}, {x: 39, y: 16}, {x: 42, y: 16}, {x: 45, y: 16}, {x: 48, y: 16}, {x: 51, y: 16},{x: 54, y: 16},
  {x: 57, y: 16}, {x: 60, y: 16}, {x: 63, y: 16}, {x: 66, y: 16}, {x: 69, y: 16},

  {x: 32.8, y: 43}, {x: 66.2, y: 43}, {x: 32.8, y: 55.2},{x: 66.2, y: 55.2},

  {x: 36, y: 30}, {x: 39, y: 30},{x: 42, y: 30},{x: 45, y: 30},{x: 48, y: 30},{x: 51, y: 30},{x: 54, y: 30},{x: 57, y: 30},{x: 60, y: 30},{x: 63, y: 30},
  {x: 36, y: 67}, {x: 39, y: 67},{x: 42, y: 67},{x: 45, y: 67},{x: 48, y: 67},{x: 51, y: 67},{x: 54, y: 67},{x: 57, y: 67},{x: 60, y: 67},{x: 63, y: 67}
];

/* ============================================================
   ğŸŸ¡ ì™•ì½”ì¸ â€” 7ê°œ
============================================================ */
const bigCoinPositions = [
  {x: 8.4, y: 82},
  {x: 26.8, y: 12},
  {x: 70.6, y: 12},
  {x: 49, y: 50},
  {x: 46.2, y: 52},
  {x: 51.8, y: 52},
  {x: 89.2, y: 82}
];

/* ============================================================
   ğŸ’ ì½”ì¸ ìƒì„± (ì „ë¶€ í‘œì‹œ)
============================================================ */
const coins = [];
coinPositions.forEach(pos => {
  const coin = document.createElement("div");
  coin.classList.add("coin");
  coin.style.left = pos.x + "vw";
  coin.style.top  = pos.y + "vh";
  stage.appendChild(coin);
  coins.push(coin);
});

// ì™•ì½”ì¸ ìƒì„±
const bigCoins = [];
bigCoinPositions.forEach(pos => {
  const bigCoin = document.createElement("div");
  bigCoin.classList.add("big-coin");
  bigCoin.style.left = pos.x + "vw";
  bigCoin.style.top  = pos.y + "vh";
  stage.appendChild(bigCoin);
  bigCoins.push(bigCoin);
});

/* ============================================================
   âŒ¨ï¸ ì´ë™ + ê²½ê³„ ì œí•œ + ë²½ ì¶©ëŒ (ë‹¨ í•˜ë‚˜ì˜ ë¦¬ìŠ¤ë„ˆë§Œ ì‚¬ìš©)
============================================================ */
window.addEventListener("keydown", e => {
  if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)) e.preventDefault();

  const rectLimit = limit.getBoundingClientRect();
  const pRectNow  = pacman.getBoundingClientRect();
  let nx = x;
  let ny = y;
// ğŸ¬ ì²« ì´ë™ í›„ 1ì´ˆ ë’¤ ì˜ìƒ ì¬ìƒ (í•œ ë²ˆë§Œ ì‹¤í–‰)
if (!window.firstMoveTriggered) {
  window.firstMoveTriggered = true;
  setTimeout(() => {
    const overlay = document.getElementById("videoOverlay");
    const video = document.getElementById("surviveVideo");
    overlay.style.display = "block";
    video.currentTime = 0;
    video.play().catch(()=>{});
    // ì˜ìƒ ëë‚˜ë©´ ë‹«íˆê¸°
    video.onended = () => overlay.style.display = "none";
  }, 1000);
}

  switch (e.key) {
    case "ArrowUp":
      ny -= speed;
      pacman.style.transform = "rotate(-90deg) scaleX(1)";
      break;
    case "ArrowDown":
      ny += speed;
      pacman.style.transform = "rotate(90deg) scaleX(1)";
      break;
    case "ArrowLeft":
      nx -= speed;
      pacman.style.transform = "rotate(0deg) scaleX(-1)";
      break;
    case "ArrowRight":
      nx += speed;
      pacman.style.transform = "rotate(0deg) scaleX(1)";
      break;
    default:
      return;
  }

  // ì´ë™ í›„ë³´ ì ìš©
  pacman.style.left = nx + "vw";
  pacman.style.top  = ny + "vh";

  // ì¶©ëŒ ê²€ì‚¬
  if (isColliding()) {
    // ğŸš« ì¶©ëŒ ì‹œ ì›ìœ„ì¹˜ ë³µê·€ + ì‚´ì§ ë°˜ë™ (íŠ•ê¹€ íš¨ê³¼)
    nx = x;
    ny = y;

    // ğŸ’¥ ì´ë™ ë°©í–¥ ë°˜ëŒ€ìª½ìœ¼ë¡œ ì•„ì£¼ ì‚´ì§ ë°€ê¸°
    const bouncePower = 0.25; // ğŸ”¹ íŠ•ê¹€ ê°•ë„ (0.2~0.3ì´ ìì—°ìŠ¤ëŸ¬ì›€)
    switch (e.key) {
      case "ArrowUp":    ny += bouncePower; break;
      case "ArrowDown":  ny -= bouncePower; break;
      case "ArrowLeft":  nx += bouncePower; break;
      case "ArrowRight": nx -= bouncePower; break;
    }

    pacman.style.left = nx + "vw";
    pacman.style.top  = ny + "vh";

    // ê·¸ë˜ë„ ë²½ê³¼ ë‹¿ìœ¼ë©´ ì™„ì „ ë¡¤ë°±
    if (isColliding()) {
      nx = x;
      ny = y;
      pacman.style.left = x + "vw";
      pacman.style.top  = y + "vh";
    }
  }

  // limit-area ë‚´ë¶€ë§Œ í—ˆìš©
  const rect = limit.getBoundingClientRect();
  const pRect = pacman.getBoundingClientRect();
  if (
    pRect.left >= rect.left &&
    pRect.right <= rect.right &&
    pRect.top >= rect.top &&
    pRect.bottom <= rect.bottom
  ) {
    x = nx;
    y = ny;
  }

  checkCoinCollision();
  checkBigCoinCollision();
  checkStageComplete();
});



/* ============================================================
   ğŸµ ì‚¬ìš´ë“œ í•¨ìˆ˜
============================================================ */
function playSmallCoinSound() {
  try { smallCoinSound.currentTime = 0; smallCoinSound.play(); } catch(e){}
}
function playBigCoinSound() {
  try { coinSound.currentTime = 0; coinSound.play(); } catch(e){}
}

/* ============================================================
   ğŸ¬ ì½”ì¸ ì¶©ëŒ ì‹œ
============================================================ */
function checkCoinCollision() {
  const pacRect = pacman.getBoundingClientRect();
  coins.forEach(c => {
    if (!c.dataset.hit) {
      const r = c.getBoundingClientRect();
      const overlap = !(
        pacRect.right < r.left ||
        pacRect.left > r.right ||
        pacRect.bottom < r.top ||
        pacRect.top > r.bottom
      );
      if (overlap) {
        c.dataset.hit = "1";
        c.style.transform = "scale(1.3)";
        c.style.opacity = "0";
        playSmallCoinSound(); // âœ… ì¼ë°˜ ì½”ì¸ ì†Œë¦¬ ì¬ìƒ
        setTimeout(() => c.remove(), 150);
      }
    }
  });
}

/* ============================================================
   ğŸ‘‘ ì™•ì½”ì¸ ì¶©ëŒ ì‹œ
============================================================ */
let bigCoinCount = 0;
function checkBigCoinCollision() {
  const pacRect = pacman.getBoundingClientRect();
  bigCoins.forEach(c => {
    if (!c.dataset.hit) {
      const r = c.getBoundingClientRect();
      const overlap = !(
        pacRect.right < r.left ||
        pacRect.left > r.right ||
        pacRect.bottom < r.top ||
        pacRect.top > r.bottom
      );
      if (overlap) {
        c.dataset.hit = "1";
        c.style.transform = "scale(1.3)";
        c.style.opacity = "0";
        playBigCoinSound(); // âœ… ì™•ì½”ì¸ ì†Œë¦¬ ì¬ìƒ
        setTimeout(() => c.remove(), 150);
        bigCoinCount++;
      }
    }
  });
}

/* ============================================================
   ğŸŠ ìŠ¤í…Œì´ì§€ ì™„ë£Œ ì²´í¬ & í‘œì‹œ
============================================================ */
function remainingCoinsCount() {
  return document.querySelectorAll('.coin:not([data-hit])').length;
}
function remainingBigCoinsCount() {
  return document.querySelectorAll('.big-coin:not([data-hit])').length;
}
function checkStageComplete() {
  if (remainingCoinsCount() === 0 && remainingBigCoinsCount() === 0) {
    showStageComplete();
  }
}
function showStageComplete() {
  const text = document.getElementById("stageCompleteText");
  if (text.style.display !== "block") {
    text.style.display = "block";
    text.style.opacity = "0";
    text.animate(
      [
        { opacity: 0, transform: "translate(-50%, -50%) scale(0.8)" },
        { opacity: 1, transform: "translate(-50%, -50%) scale(1.05)" },
        { opacity: 1, transform: "translate(-50%, -50%) scale(1)" }
      ],
      { duration: 1200, fill: "forwards", easing: "ease-out" }
    );
  }
}

/* ============================================================
   ğŸš« ë²½ ì¶©ëŒ ê°ì§€ í•¨ìˆ˜ (íšŒì „ ëŒ€ì‘ í¬í•¨)
============================================================ */
function isColliding() {
  const pRect = pacman.getBoundingClientRect();

  // ğŸ¯ íŒ©ë§¨ ì¤‘ì‹¬ ì¢Œí‘œ ê³„ì‚°
  const px = pRect.left + pRect.width / 2;
  const py = pRect.top  + pRect.height / 2;
  const radius = pRect.width * 0.4; // íŒ©ë§¨ ë°˜ê²½

  const walls = document.querySelectorAll(".wall");

  for (let w of walls) {
    const rect = w.getBoundingClientRect();
    const style = window.getComputedStyle(w);
    const transform = style.transform;

    // ğŸ“ íšŒì „ëœ ë²½ ê°ë„ ì¶”ì¶œ
    let angle = 0;
    if (transform !== "none" && transform.includes("matrix")) {
      const values = transform.match(/matrix\(([^)]+)\)/)[1].split(",");
      const a = parseFloat(values[0]);
      const b = parseFloat(values[1]);
      angle = Math.atan2(b, a); // ë¼ë””ì•ˆ
    }

    // ğŸ§® ë²½ ì¤‘ì‹¬ ë° ì ˆë°˜ í¬ê¸°
    const cx = rect.left + rect.width  / 2;
    const cy = rect.top  + rect.height / 2;
    const halfW = rect.width  / 2;
    const halfH = rect.height / 2;

    // íŒ©ë§¨ ì¢Œí‘œë¥¼ ë²½ ì¢Œí‘œê³„ë¡œ íšŒì „ ë³€í™˜
    const dx = px - cx;
    const dy = py - cy;
    const rotatedX = dx * Math.cos(-angle) - dy * Math.sin(-angle);
    const rotatedY = dx * Math.sin(-angle) + dy * Math.cos(-angle);

    // ğŸ¯ ì‹¤ì œ ì¶©ëŒ íŒì • (ì—¬ìœ  0.3 * radius)
    const hitX = Math.abs(rotatedX) <= halfW + radius * 0.3;
    const hitY = Math.abs(rotatedY) <= halfH + radius * 0.3;
    if (hitX && hitY) return true;
  }

  return false;
}



/* ============================================================
   ğŸ” ë°˜ì‘í˜• ì½”ì¸ ìœ„ì¹˜ ì¬ê³„ì‚° (ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘)
============================================================ */
function repositionCoins() {
  coins.forEach((coin, i) => {
    const pos = coinPositions[i];
    if (!coin.dataset.hit) {
      coin.style.left = pos.x + "vw";
      coin.style.top  = pos.y + "vh";
    }
  });
  // ì™•ì½”ì¸ì€ ì¢Œí‘œ ê³ ì • (ì œê±°ëœ ê±´ ê·¸ëŒ€ë¡œ ì‚­ì œ ìƒíƒœ)
}
window.addEventListener("resize", repositionCoins);


function triggerWarning() {
  const overlay = document.getElementById("warningOverlay");
  const windowBox = document.getElementById("warningWindow");
  const sound = document.getElementById("errorSound");

  // ë¯¸ë¦¬ ì‚¬ìš´ë“œ ì¤€ë¹„ (ë¸Œë¼ìš°ì € ë²„í¼ ë”œë ˆì´ ë°©ì§€)
  sound.pause();
  sound.currentTime = 0;
  sound.load();

  // ì²« ë²ˆì§¸ ì´ë¯¸ì§€ í‘œì‹œ + ë™ì‹œì— ì¬ìƒ
  overlay.style.display = "block";
  windowBox.style.backgroundImage = "url('./íŒ©ë§¨-ê²½ê³ -1.png')";
  requestAnimationFrame(() => { // âœ… ê°™ì€ ë Œë” í”„ë ˆì„ ì•ˆì—ì„œ ì‹¤í–‰
    sound.play().catch(() => {}); // ì‚¬ìš´ë“œ ì¬ìƒ
  });

  // 2ì´ˆ í›„ ë‘ ë²ˆì§¸ ì´ë¯¸ì§€ & ì¦‰ì‹œ ì¬ìƒ
  setTimeout(() => {
    sound.pause();
    sound.currentTime = 0;
    sound.load();
    windowBox.style.backgroundImage = "url('./íŒ©ë§¨-ê²½ê³ -2.png')";
    requestAnimationFrame(() => {
      sound.play().catch(() => {});
    });
  }, 2000);

  // 4ì´ˆ í›„ ì‚¬ë¼ì§€ê¸°
  setTimeout(() => {
    overlay.style.display = "none";
  }, 4000);
}


/* í˜ì´ì§€ ë¡œë“œ í›„ 10ì´ˆ ë’¤ ìë™ ì‹¤í–‰ */
window.addEventListener("load", () => {
  setTimeout(triggerWarning, 15000);
});

// ============================================================
// ğŸµ ìŠ¤í…Œì´ì§€ 1 ì „ì²´ ë¸Œê¸ˆ ì¬ìƒ
// ============================================================

// ============================================================
// ğŸµ ìŠ¤í…Œì´ì§€ 1 ì „ì²´ ë¸Œê¸ˆ â€” ì²« ì…ë ¥ ì‹œ ì¬ìƒ
// ============================================================
const bgMusic = document.getElementById("bgMusic");
bgMusic.volume = 0.6;

// ìë™ì¬ìƒ ì •ì±… ìš°íšŒ â€” í´ë¦­ ë˜ëŠ” í‚¤ì…ë ¥ 1íšŒ í•„ìš”
function unlockAudioOnce() {
  bgMusic.play().catch(() => {}); // ğŸ”Š ì²« ì…ë ¥ ì‹œ ì¬ìƒ
  window.removeEventListener("pointerdown", unlockAudioOnce);
  window.removeEventListener("keydown", unlockAudioOnce);
}
window.addEventListener("pointerdown", unlockAudioOnce, { once: true });
window.addEventListener("keydown", unlockAudioOnce, { once: true });

// í˜ì´ì§€ ë¡œë“œì‹œ ë¯¸ë¦¬ ë¡œë“œ
window.addEventListener("load", () => {
  bgMusic.load();
});

function showStageComplete() {
  const text = document.getElementById("stageCompleteText");
  const successSound = document.getElementById("successSound");

  if (text.style.display !== "block") {
    text.style.display = "block";
    text.style.opacity = "0";

    // âœ¨ ì• ë‹ˆë©”ì´ì…˜
    text.animate(
      [
        { opacity: 0, transform: "translate(-50%, -50%) scale(0.8)" },
        { opacity: 1, transform: "translate(-50%, -50%) scale(1.05)" },
        { opacity: 1, transform: "translate(-50%, -50%) scale(1)" }
      ],
      { duration: 1200, fill: "forwards", easing: "ease-out" }
    );

    // ğŸ”Š ì„±ê³µ ì‚¬ìš´ë“œ ì¬ìƒ
    try {
      successSound.currentTime = 0;
      successSound.play().catch(()=>{});
    } catch(e){}
  }
}
// ============================================================
// ğŸ§± ë²½ íˆíŠ¸ë°•ìŠ¤ ì‚´ì§ í™•ì¥ (íŒ©ë§¨ í¬ê¸° ì»¤ì§ˆ ë•Œ ë²½ ê´€í†µ ë°©ì§€ìš©)
// ============================================================
function expandWalls(paddingVW = 0.4, paddingVH = 0.4) {
  const walls = document.querySelectorAll(".wall");
  walls.forEach(wall => {
    const left = parseFloat(wall.style.left);
    const top = parseFloat(wall.style.top);
    const width = parseFloat(wall.style.width);
    const height = parseFloat(wall.style.height);

    // âœ… ì‚´ì§ í™•ì¥: 0.4vw, 0.4vh ì •ë„ë©´ ì¶©ë¶„ (í•„ìš”ì‹œ ê°’ë§Œ ì¡°ì •)
    wall.style.left = (left - paddingVW) + "vw";
    wall.style.top = (top - paddingVH) + "vh";
    wall.style.width = (width + paddingVW * 2) + "vw";
    wall.style.height = (height + paddingVH * 2) + "vh";
  });
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì ìš©
window.addEventListener("load", () => {
  expandWalls(0.65, 0.65); // ê°’ ì¡°ì ˆ ê°€ëŠ¥ (0.3~0.6 ì •ë„ ì¶”ì²œ)
});


</script>
</body>
</html>




