<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Noah Boss Fight</title>
<link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2107@1.0/DungGeunMo.css" rel="stylesheet">

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background: black;
}

.game-area {
  position: relative;
  width: calc(100vh * (16 / 9));
  height: 100vh;
  margin: 0 auto;
  overflow: hidden;
  background: url("./ë…¸ì•„ ë‹¬ë¦¬ê¸° ë§ˆì§€ë§‰.png") no-repeat center/cover;
}

#noah {
  position: absolute;
  bottom: 15%;
  left: 10%;
  width: 18%;
  image-rendering: pixelated;
  z-index: 10;
  transform: scaleX(-1);
}

#hitbox {
  position: absolute;
  width: 12%;
  height: 23%;
  left: 13%;
  bottom: 15%;
  background: rgba(0,255,0,0.2);
  pointer-events: none;
}

#monster {
  position: absolute;
  right: 5%;
  bottom: 15%;
  width: 22%;
  z-index: 15;
}

.monster-beam {
  position: absolute;
  image-rendering: pixelated;
  z-index: 20;
}

#fade {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: black;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1.5s ease;
  z-index: 999;
}
#life-ui {
  position: absolute;
  top: 3%;
  left: 3%;
  display: flex;
  gap: 0.8vh;
  z-index: 50;
}

/* í•˜íŠ¸ ì´ë¯¸ì§€ */
.life-heart {
  width: 10vh;           /* â­ í™”ë©´ ë†’ì´ ê¸°ì¤€ */
  aspect-ratio: 1 / 1;    /* ì •ì‚¬ê°í˜• ìœ ì§€ */
  image-rendering: pixelated;
}



#retry {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.retry-box {
  text-align: center;
  color: white;
  font-family: 'DungGeunMo', monospace;
}

.retry-box p {
  font-size: 2rem;
  margin-bottom: 20px;
}

.retry-box button {
  font-size: 1.2rem;
  padding: 10px 20px;
  cursor: pointer;
}

</style>
</head>

<body>

<div class="game-area">
  <div id="life-ui"></div>
  <img id="monster" src="./ë…¸ì•„ ê´´ë¬¼.gif">
  <img id="noah" src="./ë…¸ì•„ ì˜†ë³´ê¸°.gif">
  <div id="hitbox"></div>
</div>
<audio id="bgm" src="./ë…¸ì•„ ì‹¸ì›€ ë…¸ë˜.mp3" loop></audio>
<audio id="beam-shot" src="./ëª¬ìŠ¤í„° ë¹” ì†Œë¦¬.mp3"></audio>
<audio id="beam-reflect" src="./ëª¬ìŠ¤í„° ë¹” ë§‰ê¸° ì†Œë¦¬.mp3"></audio>
<audio id="monsterHitSound" src="./ëª¬ìŠ¤í„° ì•„íŒŒí•˜ëŠ” ì†Œë¦¬.mp3"></audio>
<audio id="noahHitSound" src="./ë…¸ì•„ ì•„íŒŒí•˜ëŠ” ì†Œë¦¬.mp3"></audio>
<audio id="monsterExplodeSound" src="./ê´´ë¬¼ ì¡ê³  í„°ì§.mp3"></audio>
<audio id="monsterCrySound" src="./ê´´ë¬¼ ì¡ê³  ìš¸ìŒ.mp3"></audio>


<div id="fade"></div>
<div id="retry">
  <div class="retry-box">
    <p>NOAH DOWN</p>
    <button onclick="location.reload()">ë‹¤ì‹œí•˜ê¸°</button>
  </div>
</div>
<script>
// ===========================
// ğŸ”’ íˆíŠ¸ë°•ìŠ¤ / ground ê¸°ì¤€
// ===========================
const HITBOX_DEFAULT = { height: "23%", bottom: "15%" };
const HITBOX_SLIDE   = { height: "15%", bottom: "11%" };

const HITBOX_BASE_BOTTOM = 15; // ê³„ì‚°ìš©
const GROUND_NOAH   = 15;
const GROUND_HITBOX = 15;

// ===========================
// ë…¸ì•„ ìƒíƒœ
// ===========================
const noah = document.getElementById("noah");
const hitbox = document.getElementById("hitbox");
const bgm = document.getElementById("bgm");
let noahLife = 5;
const lifeUI = document.getElementById("life-ui");
const beamShotSound = document.getElementById("beam-shot");
const beamReflectSound = document.getElementById("beam-reflect");
const monsterHitSound  = document.getElementById("monsterHitSound");
const noahHitSound     = document.getElementById("noahHitSound");
const monsterExplodeSound = document.getElementById("monsterExplodeSound");
const monsterCrySound = document.getElementById("monsterCrySound");



const idleIMG  = "./ë…¸ì•„ ì˜†ë³´ê¸°.gif";
const jumpIMG  = "./ë…¸ì•„ ë‹¬ë¦¼ ì í”„.gif";
const slideIMG = "./ë…¸ì•„ ë‹¬ë¦¼ ìŠ¬ë¼ì´ë“œ.gif";

let y = 0;
let vy = 0;
let isJump = false;
let isSlide = false;
let isDefending = false;

let monsterAlive = true;
let monsterHP = 10;

// ğŸ¬ ì—”ë”© ì „ìš©
let isEnding = false;
let endingY = 0;
let endingVy = 0;

// ===========================
// ê³µê²© ìƒì„±
// ===========================
const attackColors = [
  "#ff3b3b","#ff7f00","#ffe600",
  "#36ff4e","#00e0ff","#2d47ff",
  "#c22dff","#ff4fdc"
];

function setRandomMonsterColor(beam) {
  const c = attackColors[Math.floor(Math.random()*attackColors.length)];
  beam.style.filter = `
    drop-shadow(0 0 10px ${c})
    drop-shadow(0 0 20px ${c})
  `;
}

function shoot() {
  if (!monsterAlive) return;

  const beam = document.createElement("img");
  beam.src = "./ê´´ë¬¼ ë¹›.gif";
  beam.className = "monster-beam";
  setRandomMonsterColor(beam);
  
  // ğŸ”Š ë¹” ë°œì‚¬ ì‚¬ìš´ë“œ
beamShotSound.currentTime = 0;
beamShotSound.volume = 0.6;
beamShotSound.play().catch(()=>{});


  // ğŸ¯ ë†’ì´ íŒ¨í„´ (ìœ„/ì¤‘/ì•„ë˜)
  const beamHeights = [32, 45, 58];
  const idx = Math.floor(Math.random() * beamHeights.length);

  beam.style.right = "-12%";
  beam.style.top = beamHeights[idx] + "%";
  beam.style.width = "15%";

  document.querySelector(".game-area").appendChild(beam);

  let x = 100;
  const interval = setInterval(() => {
    if (!monsterAlive) { beam.remove(); clearInterval(interval); return; }

    x -= 1.5;
    beam.style.right = (100-x)+"%";

    const br = beam.getBoundingClientRect();
    const hr = hitbox.getBoundingClientRect();

    if (
  br.left < hr.right &&
  br.right > hr.left &&
  br.top < hr.bottom &&
  br.bottom > hr.top
) {
  if (isDefending) {
    reflectBeam(beam);
    clearInterval(interval);
    return;
  }

  // ğŸ’” ë…¸ì•„ ë°ë¯¸ì§€
  takeDamage();

  beam.remove();
  clearInterval(interval);
  return;
}


    if (br.right < 0) {
      beam.remove();
      clearInterval(interval);
    }
  },16);
}

setInterval(shoot,1500);

function takeDamage() {
  // ğŸ”Š ë…¸ì•„ í”¼ê²© ì‚¬ìš´ë“œ
  noahHitSound.currentTime = 0;
  noahHitSound.play().catch(()=>{});

  noahLife--;
  updateLifeUI();

  // ğŸ’¥ ì•„íŒŒí•˜ëŠ” GIF
  noah.src = "./ë…¸ì•„ ë‹¬ë¦¬ë‹¤ê°€ ì•„í””.gif";

  // ğŸ’¥ í”ë“¤ë¦¼ ì¶”ê°€
  noah.style.animation = "shake 0.3s linear 2";
  noah.style.transform = "scaleX(-1)";


  // ğŸ’¥ ê¹œë¹¡ì„ (ê°•í™” ë²„ì „)
  let blinkCount = 0;
  const blink = setInterval(() => {
    noah.style.opacity = (noah.style.opacity === "1") ? "0.2" : "1";
    blinkCount++;

    if (blinkCount >= 6) { // 3ë²ˆ ê¹œë¹¡
      clearInterval(blink);
      noah.style.opacity = "1";
      noah.style.animation = "none";

      // ì‚´ì•„ìˆìœ¼ë©´ ì›ë˜ ìƒíƒœë¡œ
      if (noahLife > 0 && !isEnding) {
        noah.src = idleIMG;
        noah.style.transform = "scaleX(-1)";

      }
    }
  }, 80);

  // â˜ ï¸ ì‚¬ë§ ì²˜ë¦¬
  if (noahLife <= 0) {
    clearInterval(blink);
    noahDie();
  }
}


function updateLifeUI() {
  lifeUI.innerHTML = "";

  for (let i = 0; i < noahLife; i++) {
    const heart = document.createElement("img");
    heart.src = "./ëª©ìˆ¨.png";   // â† ë„¤ê°€ ì˜¬ë¦° í•˜íŠ¸ PNG
    heart.className = "life-heart";
    lifeUI.appendChild(heart);
  }
}


function noahDie() {
  monsterAlive = false;
  isEnding = false;

  // ì¡°ì‘ ì™„ì „ ì°¨ë‹¨
  window.onkeydown = null;
  window.onkeyup = null;

  // ë…¸ì•„ ì£½ìŒ ì´ë¯¸ì§€
  noah.src = "./ë…¸ì•„ ì£½ìŒ.png";

  // íˆíŠ¸ë°•ìŠ¤ ì œê±°
  hitbox.style.display = "none";

  // BGM ì •ì§€
  if (bgm) {
    bgm.pause();
    bgm.currentTime = 0;
  }

  // ë‹¤ì‹œí•˜ê¸° UI í‘œì‹œ
  document.getElementById("retry").style.display = "flex";
}


// ===========================
// ğŸ’¥ ë³´ìŠ¤ ì‚¬ë§
// ===========================
function killMonster() {
  monsterAlive = false;
  const monster = document.getElementById("monster");

  monster.style.transition = "transform .15s, filter .15s";
  monster.style.transform = "scale(1.3)";
  monster.style.filter = "brightness(3)";

  setTimeout(()=>{
    monster.style.transition = "transform .25s, opacity .25s";
    monster.style.transform = "scale(2)";
    monster.style.opacity = 0;
  },150);
  // ğŸ”Š ê´´ë¬¼ í„°ì§ ì‚¬ìš´ë“œ (2ë²ˆ)
monsterExplodeSound.currentTime = 0;
monsterExplodeSound.volume = 1.0;
monsterExplodeSound.play().catch(()=>{});

// ğŸ”Š ì ê¹ í›„ ìš¸ìŒ ì‚¬ìš´ë“œ (1ë²ˆ)
setTimeout(() => {
  monsterCrySound.currentTime = 0;
  monsterCrySound.volume = 1.0;
  monsterCrySound.play().catch(()=>{});
}, 400);

  setTimeout(()=>{
    const icons = [
      "./ë©”ì„¸ì§€ ì•„ì´ì½˜.png",
      "./í´ë” ì•„ì´ì½˜.png",
      "./ìŒì•…ì•„ì´ì½˜.png",
      "./ì¸í„°ë„· ë¡œê³ .png"
    ];

    const list = [...icons];
    while (list.length < 25)
      list.push(icons[Math.floor(Math.random()*icons.length)]);

    list.forEach(src=>{
      const i = document.createElement("img");
      i.src = src;
      i.style.position="absolute";
      i.style.width="8%";
      i.style.left="50%";
      i.style.top="50%";
      document.querySelector(".game-area").appendChild(i);

      let x=48+Math.random()*4, y=48+Math.random()*4;
      let vx=(Math.random()-.5)*4, vy=Math.random()*-4-1;

      const fall=setInterval(()=>{
        x+=vx; y+=vy; vy+=.15;
        i.style.left=x+"%";
        i.style.top=y+"%";
        if(y>120){ clearInterval(fall); i.remove(); }
      },16);
    });
  },200);

  setTimeout(() => {
  // ğŸ¯ ë…¸ì•„ ì í”„ & ì¶”ë½ ì‹œì‘ (ì•„ì´ì½˜ í„°ì§„ í›„ 1ì´ˆ)
  startEndingSequence();
}, 2500); // ì•„ì´ì½˜(1.5ì´ˆ) + ì—¬ìœ  1ì´ˆ


}

// ===========================
// ğŸ¬ ì—”ë”© ì—°ì¶œ
// ===========================
function startEndingSequence() {
  isEnding = true;

  // ğŸ¯ ì í”„ ì‹œì‘
  endingY = 0;
  endingVy = 2.2;              // ì í”„ ì†ë„ ì¤„ì„
  noah.src = jumpIMG;

  // â± 0.6ì´ˆ ë™ì•ˆì€ ê³µì¤‘ì— ë–  ìˆê²Œ
  setTimeout(() => {
    endingVy = -0.2;           // ê·¸ ë‹¤ìŒë¶€í„° ì¶”ë½ ì‹œì‘
  }, 600);
}


// ===========================
// ë£¨í”„
// ===========================
function loop() {
  if (isJump) {
    vy -= .08;
    y += vy;
    noah.style.bottom = (GROUND_NOAH+y)+"%";
    hitbox.style.bottom = (HITBOX_BASE_BOTTOM+y)+"%";
    if (y<=0) {
      y=0; vy=0; isJump=false;
      noah.style.bottom=GROUND_NOAH+"%";
      hitbox.style.bottom=HITBOX_DEFAULT.bottom;
      if(!isDefending) noah.src=idleIMG;
    }
  }

  if (isEnding) {
   // ğŸµ BGM í˜ì´ë“œì•„ì›ƒ ì‹œì‘
  let fadeAudio = setInterval(() => {
    if (bgm.volume > 0.05) {
      bgm.volume -= 0.05;
    } else {
      bgm.volume = 0;
      bgm.pause();
      clearInterval(fadeAudio);
    }
  }, 100);
    endingVy -= .12;
    endingY += endingVy;
    noah.style.bottom = (GROUND_NOAH+endingY)+"%";
    hitbox.style.bottom = (GROUND_HITBOX+endingY)+"%";

    if (endingY < -70) {
      document.getElementById("fade").style.opacity = 1;
      setTimeout(()=>location.href="noah last.html",1500);
      isEnding=false;
    }
  }

  requestAnimationFrame(loop);
}
loop();
updateLifeUI();

// ===========================
// í‚¤ ì…ë ¥
// ===========================
window.addEventListener("keydown",e=>{
  // ğŸ”Š BGM ìµœì´ˆ ì¬ìƒ (ë¸Œë¼ìš°ì € ìë™ì¬ìƒ ì œí•œ ë•Œë¬¸ì— í‚¤ ì…ë ¥ ë•Œ ì‹œì‘)
  if (bgm && bgm.paused) {
    bgm.volume = 1.0; // 0~1
    bgm.play().catch(()=>{});
  }

  if(e.code==="Space"&&!isJump&&!isSlide){
    isJump=true; vy=2.2; noah.src=jumpIMG;
  }
  if(e.code==="ArrowDown"&&!isJump&&!isSlide){
    isSlide=true; noah.src=slideIMG;
    hitbox.style.height=HITBOX_SLIDE.height;
    hitbox.style.bottom=HITBOX_SLIDE.bottom;
  }
  if(e.code==="KeyZ"&&!isJump){
    isDefending=true; noah.src="./ë…¸ì•„ ë°©ì–´.png";
  }
});

window.addEventListener("keyup",e=>{
  if(e.code==="ArrowDown"){
    isSlide=false; noah.src=idleIMG;
    hitbox.style.height=HITBOX_DEFAULT.height;
    hitbox.style.bottom=HITBOX_DEFAULT.bottom;
  }
  if(e.code==="KeyZ"){
    isDefending=false; noah.src=idleIMG;
  }
});

function reflectBeam(beam) {

  /* =========================
     1ï¸âƒ£ í˜„ì¬ ë¹” ìœ„ì¹˜ ê³„ì‚°
  ========================= */
  const beamRect = beam.getBoundingClientRect();
  const gameRect = document
    .querySelector(".game-area")
    .getBoundingClientRect();

  let x = ((beamRect.left - gameRect.left) / gameRect.width) * 100;
  let y = ((beamRect.top - gameRect.top) / gameRect.height) * 100;

  /* =========================
     2ï¸âƒ£ ë¹” ë°©í–¥ ë°˜ì „
  ========================= */
  beam.style.left = x + "%";
  beam.style.top = y + "%";
  beam.style.right = "auto";
  beam.style.transform = "scaleX(-1)";

  // ğŸ”Š ë¹” ë°˜ì‚¬ ì‚¬ìš´ë“œ
beamReflectSound.currentTime = 0;
beamReflectSound.volume = 0.7;
beamReflectSound.play().catch(()=>{});

  /* =========================
     3ï¸âƒ£ ë°˜ì‚¬ ì´ë™ ë£¨í”„
  ========================= */
  const reflectInterval = setInterval(() => {

    // ë¹” ì´ë™
    x += 2.5;
    beam.style.left = x + "%";

    const monsterRect = document
      .getElementById("monster")
      .getBoundingClientRect();

    const beamNow = beam.getBoundingClientRect();

    /* =========================
       4ï¸âƒ£ ê´´ë¬¼ ì¶©ëŒ íŒì •
    ========================= */
    const hitMonster =
      beamNow.left < monsterRect.right &&
      beamNow.right > monsterRect.left &&
      beamNow.top < monsterRect.bottom &&
      beamNow.bottom > monsterRect.top;

    if (hitMonster) {

      monsterHP--;

      // ğŸ”Š ëª¬ìŠ¤í„° í”¼ê²© ì‚¬ìš´ë“œ
monsterHitSound.currentTime = 0;
monsterHitSound.play().catch(()=>{});


      const monster = document.getElementById("monster");

      /* ğŸ”¥ ë°ë¯¸ì§€ ì—°ì¶œ */
      monster.style.filter =
        "brightness(2) sepia(1) hue-rotate(-30deg)";
      monster.style.opacity = "0.5";

      setTimeout(() => {
        monster.style.filter = "none";
        monster.style.opacity = "1";
      }, 120);

      beam.remove();
      clearInterval(reflectInterval);

      if (monsterHP <= 0) {
        killMonster();
      }
      return;
    }

    /* =========================
       5ï¸âƒ£ í™”ë©´ ë°– ì²˜ë¦¬
    ========================= */
    if (x > 120) {
      beam.remove();
      clearInterval(reflectInterval);
    }

  }, 16);
}

</script>
</body>
</html>



