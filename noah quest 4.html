<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>ë…¸ì•„ í€˜ìŠ¤íŠ¸ 4 â€” ì•„ì´ì½˜ í­ìš°(Stage)</title>
<link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2107@1.0/DungGeunMo.css" rel="stylesheet">
<style>
/* ============================================================
   ğŸ”¥ 16:9 ê³ ì • ë¹„ìœ¨ ì „ì²´ ë˜í¼
============================================================ */
html, body {
  margin: 0;
  width: 100vw;
  height: 100vh;
  background: #000;
  overflow: hidden;
}

/* 16:9 ì¤‘ì•™ ì •ë ¬ */
.game-container {
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #000;
  overflow: hidden;
}

/* 16:9 ìº”ë²„ìŠ¤ */
.game-area {
  position: relative;
  width: calc(100vh * (16 / 9));
  height: 100vh;
  max-width: 100vw;
  max-height: calc(100vw * (9 / 16));
  background: #000;
  overflow: hidden;
  image-rendering: pixelated;
}

/* ============================================================
   ğŸ® ìŠ¤í…Œì´ì§€ ë°°ê²½ (ë°˜ì‘í˜•)
============================================================ */
.stage {
  position: absolute;
  inset: 0;
  background-image: url('./ë…¸ì•„ í€˜ìŠ¤íŠ¸ 4 í™”ë©´.png');
  background-repeat: repeat-x;
  background-size: contain;
  background-position: center bottom;
  image-rendering: pixelated;
}

/* ============================================================
   ğŸ‘¦ ë…¸ì•„ ìºë¦­í„° (GIF ë©ˆì¶¤X, í¼ì„¼íŠ¸ ê¸°ë°˜)
============================================================ */
#noah {
  position: absolute;
  bottom: 8%;
  left: 45%;
  width: 8%;
  image-rendering: pixelated;
  pointer-events: none;
  transition: transform 0.12s linear;
  z-index: 10;
}

/* ============================================================
   ğŸ§‘â€ğŸ« êµìˆ˜ ìºë¦­í„°
============================================================ */
#profWalk, #profIdle {
  position: absolute;
  bottom: 8%;
  width: 8%;
  display: none;
  image-rendering: pixelated;
  z-index: 20;
  transform: scaleX(-1);
}

/* êµìˆ˜ ê±¸ì–´ì˜¤ê¸° */
.prof-walk-in {
  animation: profWalkIn 3s linear forwards;
}
@keyframes profWalkIn {
  from { left: -12%; }
  to   { left: 36%; }
}

/* ============================================================
   ğŸ¥ ì»·ì”¬ìš© ë ˆì´ì–´
============================================================ */
#cutsceneBg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  object-fit: cover;
  z-index: 50;
}

#glassLayer {
  position: absolute;
  inset: 0;
  display: none;
  backdrop-filter: blur(0.3vh) brightness(0.92);
  background: rgba(0,0,0,0.15);
  z-index: 55;
}

#dimLayer {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.75);
  display: none;
  z-index: 60;
}

/* CG (ë…¸ì•„ ë©˜ë¶•) */
.talk-cg {
  position: absolute;
  bottom: 9%;
  right: 30%;
  width: 40%;
  display: none;
  image-rendering: pixelated;
  z-index: 70;
}

/* ============================================================
   ğŸ™ ìë§‰ ë°•ìŠ¤
============================================================ */
.subtitle-box {
  position: absolute;
  bottom: 4%;
  left: 50%;
  transform: translateX(-50%);
  padding: 1.3% 2.5%;
  background: rgba(15,0,0,.55);
  border: .3vw solid #ff0028;
  border-radius: .5vw;
  backdrop-filter: blur(2px);
  font-family: "DungGeunMo", monospace;
  font-size: 2.2vh;
  color: #ff2b3b;
  text-shadow: 0 0 .6vw #ff0028, 0 0 1vw #ff0048;

  display: flex;
  gap: 1vw;
  align-items: center;

  white-space: nowrap;      /* â­ í•œ ì¤„ ê³ ì • */
  opacity: 0;
  transition: opacity .25s;

  z-index: 999999;          /* â­ ìµœìƒìœ„ ê³ ì • */
}

.subtitle-box.show { opacity: 1; }

.next-btn {
  padding: .7% 1.8%;
  background: #ff0008;
  border: .25vw solid #8b0000;
  font-family: "DungGeunMo";
  font-size: 2vh;
  color: white;
  cursor: pointer;
}

/* ============================================================
   â± íƒ€ì´ë¨¸
============================================================ */
#timer {
  position: absolute;
  top: 2%;
  left: 2%;
  font-family: "DungGeunMo";
  font-size: 5vh;
  color: #00ff88;
  text-shadow: 0 0 .6vw #00ff66,0 0 1vw #00ffaa;
  z-index: 999;
  display: none;
}

/* ============================================================
   ğŸŒ§ ë–¨ì–´ì§€ëŠ” ì•„ì´ì½˜
============================================================ */
.falling-icon {
  position: absolute;
  top: -10%;
  width: 5%;
  image-rendering: pixelated;
  z-index: 999;
  filter: drop-shadow(0.3vw 0.6vh 0 rgba(0,0,0,0.9));
}

/* ì¶©ëŒ í”¼ê²© íš¨ê³¼ */
@keyframes hitFlash {
  0% { filter: brightness(2) sepia(1) saturate(4); }
  100% { filter: none; }
}

/* í™”ë©´ í”ë“¤ë¦¼ */
@keyframes screenShake {
  0% { transform: translate(0,0); }
  20% { transform: translate(-1vw, -1vh); }
  40% { transform: translate(1vw, 1vh); }
  60% { transform: translate(-1vw, 1vh); }
  80% { transform: translate(1vw, -1vh); }
  100% { transform: translate(0,0); }
}
.screen-shake { animation: screenShake 0.4s ease-in-out; }

/* í™”ë©´ í˜ì´ë“œ */
#dimFade {
  position:fixed;
  inset:0;
  background:black;
  opacity:0;
  pointer-events:none;
  z-index:9000;
  transition:opacity 0.8s;
}
</style>
</head>

<body>

<!-- BGM -->
<audio id="bgm" src="./í€˜ìŠ¤íŠ¸ 4 ë°°ê²½ìŒ.mp3" loop></audio>
<audio id="profStep" src="./êµìˆ˜ ê±·ê¸°.mp3"></audio>
<audio id="typeSound" src="./êµìˆ˜ ëª©ì†Œë¦¬.mp3"></audio>
<audio id="rainBgm" src="./ì•„ì´ì½˜ ë‚´ë ¤ì˜´ ë°°ê²½ìŒ.mp3" loop></audio>
<audio id="nextSound" src="./ë‹¤ìŒ í´ë¦­.mp3"></audio>


<!-- í˜ì´ë“œ -->
<div id="dimFade"></div>

<!-- 16:9 í™”ë©´ -->
<div class="game-container">
  <div class="game-area">

    <!-- ìŠ¤í…Œì´ì§€ -->
    <div class="stage">
      <img id="noah" src="./ë…¸ì•„ ë¯¸ë‹ˆ ì•ê±·ê¸°.gif">
    </div>

    <!-- ì»·ì”¬ ë ˆì´ì–´ -->
    <img id="cutsceneBg" src="./ë…¸ì•„ ì—†ëŠ” ë°©.png">
    <div id="glassLayer"></div>
    <div id="dimLayer"></div>

    <!-- CG -->
    <img id="noahCG"  class="talk-cg" src="./ë…¸ì•„ ë©˜ë¶• 1.png">
    <img id="noahCG2" class="talk-cg" src="./ë…¸ì•„ ë©˜ë¶• 2.gif">
    <img id="noahCG3" class="talk-cg" src="./ë…¸ì•„ ë©˜ë¶• 3.gif">

    <!-- êµìˆ˜ -->
    <img id="profWalk" src="./êµìˆ˜ ë¯¸ë‹ˆ 2.gif" style="left:-12%;">
    <img id="profIdle" src="./êµìˆ˜ ë¯¸ë‹ˆ 1.gif" style="left:36%;">

    <!-- ìë§‰ -->
    <div id="subtitle" class="subtitle-box">
      <span id="subtitleText"></span>
      <div class="next-btn" onclick="nextScene()">>ë‹¤ìŒ</div>
    </div>

    <!-- íƒ€ì´ë¨¸ -->
    <div id="timer">15</div>

    <!-- íš¨ê³¼ìŒë“¤ -->
    <audio id="bangSound" src="./ë¬¸ ì¾…ì¾….mp3"></audio>
    <audio id="profLaugh" src="./êµìˆ˜ ì›ƒìŒì†Œë¦¬.mp3"></audio>
    <audio id="bgmGame" src="./í€˜ìŠ¤íŠ¸4_ê²Œì„bgm.mp3" loop></audio>
    <audio id="hitSound" src="./ì•„ì´ì½˜ ì¶©ëŒ.mp3"></audio>
    <audio id="loseSound" src="./ì•„ì´ì½˜ ê²Œì„ ì§.mp3"></audio>
    <audio id="winSound" src="./ì•„ì´ì½˜ ê²Œì„ ì„±ê³µ.mp3"></audio>

  </div>
</div>


<script>
/* ============================================================
   ğŸ”Š BGM ì„¤ì •
============================================================ */
const bgm = document.getElementById("bgm");
bgm.volume = 0.4;
window.addEventListener("click", () => {
  if (bgm.paused) bgm.play().catch(()=>{});
}, { once:true });

/* ============================================================
   ğŸ® ì´ë™ ê´€ë ¨ ë³€ìˆ˜
============================================================ */
let hp = 3;
let gameMode = "normal";
let isDead = false;
let timeLeft = 15;
let timerInterval;

const noah = document.getElementById("noah");
const timerEl = document.getElementById("timer");
const typeSound = document.getElementById("typeSound");
typeSound.volume = 0.35;
const subtitle = document.getElementById("subtitle");
const subtitleText = document.getElementById("subtitleText");
const nextSound = document.getElementById("nextSound");
nextSound.volume = 1;

function playNextSound(){
  nextSound.pause();
  nextSound.currentTime = 0;
  nextSound.play().catch(()=>{});
}


let x = 45;
let speed = 0.35;
let moving = false;
let keys = { left:false, right:false };
let currentAnim = "idle";

/* ============================================================
   ğŸƒ ë…¸ì•„ ì´ë™
============================================================ */
function update(){
  if (isDead){
    requestAnimationFrame(update);
    return;
  }

  if (keys.left){
    x -= speed;
    if (gameMode === "dodge"){
      if (currentAnim !== "dodge"){
        noah.src = "./ë…¸ì•„ í”¼í•¨.gif";
        currentAnim = "dodge";
      }
    } else {
      if (currentAnim !== "walkLeft"){
        noah.src = "./ë…¸ì•„ ë¯¸ë‹ˆ ì˜† ê±·ê¸°.gif";
        currentAnim = "walkLeft";
      }
    }
    noah.style.transform="scaleX(1)";
    moving=true;
  }

  else if (keys.right){
    x += speed;
    if (gameMode === "dodge"){
      if (currentAnim !== "dodge"){
        noah.src = "./ë…¸ì•„ í”¼í•¨.gif";
        currentAnim = "dodge";
      }
    } else {
      if (currentAnim !== "walkRight"){
        noah.src = "./ë…¸ì•„ ë¯¸ë‹ˆ ì˜† ê±·ê¸°.gif";
        currentAnim = "walkRight";
      }
    }
    noah.style.transform="scaleX(-1)";
    moving=true;
  }

  else {
    if (moving){
      if (gameMode !== "dodge" && currentAnim !== "idle"){
        noah.src = "./ë…¸ì•„ ë¯¸ë‹ˆ ì•ê±·ê¸°.gif";
        currentAnim = "idle";
      }
      moving=false;
    }
  }

  if (x < 0) x = 0;
  if (x > 92) x = 92;
  noah.style.left = x + "%";

  requestAnimationFrame(update);
}

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft") keys.left=true;
  if(e.key==="ArrowRight") keys.right=true;
});
document.addEventListener("keyup", e=>{
  if(e.key==="ArrowLeft") keys.left=false;
  if(e.key==="ArrowRight") keys.right=false;
});

update();

/* ============================================================
   ğŸ™ ìë§‰ ì‹œìŠ¤í…œ
============================================================ */
let typeTimer=null;

function hideSubtitle(){
  subtitle.classList.remove("show");
  if(typeTimer){ clearTimeout(typeTimer); typeTimer=null; }
}

function showSubtitleNoah(text){
  hideSubtitle();
  subtitleText.textContent = text;
  subtitle.classList.add("show");
}

function showSubtitleProf(text){
  hideSubtitle();
  subtitleText.textContent = "";
  subtitle.classList.add("show");

  let i=0;
  typeSound.currentTime=0;
  typeSound.play().catch(()=>{});
  typeSound.onended = ()=>{ typeSound.currentTime=0; typeSound.play().catch(()=>{}); };

  const laugh = document.getElementById("profLaugh");

  (function typeWriter(){
    if(i < text.length){
      subtitleText.textContent += text[i];
      i++;
      typeTimer = setTimeout(typeWriter, 40);
    } else {
      typeSound.pause();
      typeSound.currentTime=0;
      typeSound.onended=null;

      setTimeout(()=>{
        let vol = laugh.volume;
        const fade = setInterval(()=>{
          vol -= 0.02;
          if(vol <= 0){
            laugh.pause(); laugh.currentTime=0; laugh.volume=0.55;
            clearInterval(fade);
          } else laugh.volume=vol;
        },80);
      },1000);
    }
  })();
}

/* ============================================================
   ğŸ¬ ì»·ì”¬ ì‹œí€€ìŠ¤
============================================================ */
let sceneIndex = 0;

function nextScene(){
  playNextSound();   // ğŸ”Š ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ ì‚¬ìš´ë“œ
  sceneIndex++;

  if(sceneIndex===1){
    fadeToBlack(()=>{
      cutsceneBg.style.display="block";
      glassLayer.style.display="block";
      showSubtitleNoah("ì €ê±´ ë‚´ ë°©ì´ì–ì•„..!");
    });
  }
  else if(sceneIndex===2){
    cutsceneBg.style.display="none";
    glassLayer.style.display="none";
    dimLayer.style.display="block";
    noahCG.style.display="block";
    showSubtitleNoah("ë‚˜â€¦ ì—¬ê¸° ê°‡íŒ ê±°ì•¼â€¦?");
  }
  else if(sceneIndex===3){
    noahCG.style.display="none";
    noahCG2.style.display="block";
    showSubtitleNoah("ì‚´ë ¤ì£¼ì„¸ìš”!! ì‚´ë ¤ì£¼ì„¸ìš”!!");

    const bang = document.getElementById("bangSound");
    bang.currentTime=0; bang.play();

    document.body.classList.add("screen-shake");
    setTimeout(()=> document.body.classList.remove("screen-shake"),450);
  }
  else if(sceneIndex===4){
    dimLayer.style.display="none";
    noahCG2.style.display="none";
    hideSubtitle();

    setTimeout(()=>{
      const step=document.getElementById("profStep");
      step.volume=0.4; step.currentTime=0; step.play();

      profWalk.style.display="block";
      profWalk.classList.add("prof-walk-in");

      setTimeout(()=>{
        profWalk.style.display="none";
        profIdle.style.display="block";
        step.pause(); step.currentTime=0;

        setTimeout(()=>{
          dimLayer.style.display="block";
          noahCG3.style.display="block";
          showSubtitleNoah("í”„ë­í´ë¦° êµìˆ˜ë‹˜..?");
        },1000);

      },3000);

    },3000);
  }

  else if(sceneIndex===5){
    dimLayer.style.display="block";
    noahCG3.style.display="none";

    subtitle.style.borderColor="#00ff66"; 
    subtitle.style.color="#00ff88";
    subtitle.style.textShadow="0 0 .6vw #00ff66, 0 0 1vw #00ffaa";

    document.body.insertAdjacentHTML("beforeend",`
      <img id="profClose1" src="./êµìˆ˜ ë§í•¨ 1.gif" 
        style="position:fixed; bottom:9%; left:50%;
        transform:translateX(-50%); width:40%; z-index:9999;
        image-rendering:pixelated;">
    `);

    showSubtitleProf("ë„ˆê°€ ë¬¸ì œë¥¼ í‹€ë ¸ìœ¼ë‹ˆ.\nì‘ì€ ë²Œì„ ì¤„ê±°ì•¼.\ní•œë²ˆ ì´ê²¨ë³´ë ´");
  }

  else if(sceneIndex===6){
    document.getElementById("profClose1").remove();
    noahCG3.style.display="block";

    subtitle.style.borderColor="#ff0028"; 
    subtitle.style.color="#ff2b3b";
    subtitle.style.textShadow="0 0 .6vw #ff0028, 0 0 1vw #ff0048";

    showSubtitleNoah("ì–´ë–¤ê±°ì£ ?");
  }

  else if(sceneIndex===7){
    noahCG3.style.display="none";

    subtitle.style.borderColor="#00ff66"; 
    subtitle.style.color="#00ff88";
    subtitle.style.textShadow="0 0 .6vw #00ff66, 0 0 1.2vw #00ffaa";

    document.body.insertAdjacentHTML("beforeend",`
      <img id="profClose2" src="./êµìˆ˜ ë§í•¨ 2.gif" 
        style="position:fixed; bottom:9%; left:50%;
        transform:translateX(-50%); width:40%; z-index:9999;
        image-rendering:pixelated;">
    `);

    const laugh=document.getElementById("profLaugh");
    laugh.volume=0.55;
    laugh.currentTime=0;
    laugh.play().catch(()=>{});

    showSubtitleProf("í•˜ëŠ˜ì—ì„œ ë–¨ì–´ì§€ëŠ”\nì•„ì´ì½˜ë“¤ì„\ní”¼í•´ë´!!");
  }

  else if(sceneIndex===8){
    document.getElementById("profClose2").remove();
    hideSubtitle();
    dimLayer.style.display="none";

    document.body.insertAdjacentHTML("beforeend",`
      <div id="questPopup" style="
        position:fixed; top:50%; left:50%;
        transform:translate(-50%,-50%);
        padding:2vh 3vw;
        background:black;
        border:.5vw solid #ff0028;
        color:#ff2b3b;
        font-family:'DungGeunMo';
        font-size:3vh;
        text-align:center;
        z-index:20000;
        box-shadow:0 0 1vw #ff0048;">
        <br>ì•„ì´ì½˜ì„ í”¼í•´ë¼!!
        <br><br>
        <button id="questStart" style="
          margin-top:2vh; padding:1vh 2vw;
          font-family:'DungGeunMo'; font-size:2vh;
          border:.3vw solid #8b0000; background:#ff0008;
          color:white; cursor:pointer;">í™•ì¸</button>
      </div>
    `);

    document.getElementById("questStart").onclick = ()=>{
      document.getElementById("questPopup").remove();
      bgm.pause(); bgm.currentTime=0;

      const gameBgm=document.getElementById("bgmGame");
      gameBgm.volume=0.5; gameBgm.currentTime=0;
      gameBgm.play().catch(()=>{});

      setTimeout(()=> startIconRainGame(), 1000);
    };
  }
}

/* ============================================================
   ğŸŒ§ ì•„ì´ì½˜ ë¹„ ì‹œìŠ¤í…œ
============================================================ */
const icons = [
  "ì•„ì´ì½˜ 1.png","ì•„ì´ì½˜ 2.png",
  "ì•„ì´ì½˜ 3.png","ì•„ì´ì½˜ 4.png",
  "ì•„ì´ì½˜ 5.png"
];

let rainInterval=null;

function createFallingIcon(){
  const icon=document.createElement("img");
  icon.src="./" + icons[Math.floor(Math.random()*icons.length)];
  icon.className="falling-icon";
  icon.style.left = Math.random()*90 + "%";
  document.querySelector(".game-area").appendChild(icon);

  let y=-10;
  const fallSpeed = 0.35 + Math.random()*0.5;

  function fall(){
    y += fallSpeed;
    icon.style.top = y+"%";

    const nr = noah.getBoundingClientRect();
    const ir = icon.getBoundingClientRect();
    const pad=15;

    const hit = !(
      nr.right-pad < ir.left+pad ||
      nr.left+pad > ir.right-pad ||
      nr.bottom-pad < ir.top+pad ||
      nr.top+pad > ir.bottom-pad
    );

    if(hit){
      takeDamage(icon);
      return;
    }

    if(y < 120) requestAnimationFrame(fall);
    else icon.remove();
  }
  requestAnimationFrame(fall);
}

/* ============================================================
   ğŸ® ì•„ì´ì½˜ ê²Œì„ ì‹œì‘
============================================================ */
function startIconRainGame(){
  const loseSound=document.getElementById("loseSound");
  loseSound.pause(); loseSound.currentTime=0;

  hp=3; isDead=false; timeLeft=15;
  timerEl.textContent=timeLeft;
  timerEl.style.display="block";

  gameMode="dodge";
  noah.src="./ë…¸ì•„ í”¼í•¨.gif";
  noah.style.transform="scaleX(1)";
  x=45; noah.style.left="45%";
  currentAnim="dodge";

  const gameBgm=document.getElementById("bgmGame");
  gameBgm.volume=0.5; gameBgm.currentTime=0;
  gameBgm.play().catch(()=>{});

  const rainBgm=document.getElementById("rainBgm");
  rainBgm.volume=0.45; rainBgm.currentTime=0;
  rainBgm.play().catch(()=>{});

  rainInterval=setInterval(createFallingIcon, 180);

  timerInterval = setInterval(()=>{
    timeLeft--;
    timerEl.textContent=timeLeft;
    if(timeLeft<=0){
      questSuccess();
    }
  },1000);
}

/* ============================================================
   ğŸ’¥ ë°ë¯¸ì§€
============================================================ */
function takeDamage(icon){
  hp--;
  if(icon) icon.remove();

  const hitSound=document.getElementById("hitSound");
  hitSound.currentTime=0;
  hitSound.volume=0.6;
  hitSound.play().catch(()=>{});

  noah.style.animation="hitFlash 0.25s";
  setTimeout(()=> noah.style.animation="",250);

  if(hp<=0) playerDeath();
}

/* ============================================================
   ğŸ‰ ì„±ê³µ
============================================================ */
function questSuccess(){
  clearInterval(rainInterval);
  clearInterval(timerInterval);
  timerEl.style.display="none";
  document.querySelectorAll(".falling-icon").forEach(e=>e.remove());

  const gameBgm=document.getElementById("bgmGame");
  const rainBgm=document.getElementById("rainBgm");
  gameBgm.pause(); gameBgm.currentTime=0;
  rainBgm.pause(); rainBgm.currentTime=0;

  const winSound=document.getElementById("winSound");
  winSound.currentTime=0; winSound.volume=0.7;
  winSound.play().catch(()=>{});

  keys.left=false; keys.right=false; moving=false;

  noah.src="./ë…¸ì•„ ë¯¸ë‹ˆ ì„±ê³µ.gif";
  noah.style.transform="scaleX(1)";
  currentAnim="success";

  document.body.insertAdjacentHTML("beforeend",`
    <div id="successPopup" style="
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%);
      padding:2vh 3vw;
      background:black;
      border:.5vw solid #ff0028;
      color:#ff2b3b;
      font-family:'DungGeunMo';
      font-size:3vh;
      text-align:center;
      z-index:20000;
      box-shadow:0 0 1vw #ff0048;">
      <br>ì„±ê³µ!
      <br><br>
      <button id="successNext" style="
        margin-top:2vh; padding:1vh 2vw;
        font-family:'DungGeunMo'; font-size:2vh;
        border:.3vw solid #8b0000;
        background:#ff0008; color:white;
        cursor:pointer;">í™•ì¸</button>
    </div>
  `);

  document.getElementById("successNext").onclick = ()=>{
    document.getElementById("successPopup").remove();

    subtitle.style.borderColor="#00ff66"; 
    subtitle.style.color="#00ff88";
    subtitle.style.textShadow="0 0 .6vw #00ff66, 0 0 1.2vw #00ffaa";

    dimLayer.style.display="block";

    document.body.insertAdjacentHTML("beforeend",`
      <img id="profReturn" src="./êµìˆ˜ ë§í•¨ 1.gif" style="
        position:fixed; bottom:9%; left:50%;
        transform:translateX(-50%);
        width:40%; z-index:10001;
        image-rendering:pixelated;">
    `);

    showSubtitleProf("ë‹¤ìŒë¶€í„´ ë¬¸ì œë¥¼ í‹€ë¦¬ì§€ ì•Šë„ë¡ í•´.");

    document.querySelector(".next-btn").onclick = ()=>{
      document.getElementById("profReturn").remove();
      window.location.href = "noah computer main 6.html";
    };
  };
}

/* ============================================================
   ğŸ’€ ì‚¬ë§
============================================================ */
function playerDeath(){
  isDead=true;

  clearInterval(rainInterval);
  clearInterval(timerInterval);
  timerEl.style.display="none";
  document.querySelectorAll(".falling-icon").forEach(e=>e.remove());

  noah.src="./ë…¸ì•„ ì£½ìŒ.png";
  noah.style.transform="scaleX(1)";
  currentAnim="dead";

  const gameBgm=document.getElementById("bgmGame");
  const rainBgm=document.getElementById("rainBgm");
  gameBgm.pause(); gameBgm.currentTime=0;
  rainBgm.pause(); rainBgm.currentTime=0;

  const loseSound=document.getElementById("loseSound");
  loseSound.currentTime=0; loseSound.volume=0.7;
  loseSound.play().catch(()=>{});

  setTimeout(showDeathPopup, 700);
}

/* ============================================================
   ğŸ” ì‚¬ë§ â†’ ì¬ë„ì „ íŒì—…
============================================================ */
function showDeathPopup(){
  document.body.insertAdjacentHTML("beforeend",`
    <div id="deathPopup" style="
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%);
      padding:2vh 3vw;
      background:black;
      border:.5vw solid #ff0028;
      color:#ff2b3b;
      font-family:'DungGeunMo';
      font-size:3vh;
      text-align:center;
      z-index:20000;
      box-shadow:0 0 1vw #ff0048;">
      <br>ë‹¤ì‹œ ë„ì „í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
      <br><br>
      <button id="deathRestart" style="
        margin-top:2vh; padding:1vh 2vw;
        font-family:'DungGeunMo'; font-size:2vh;
        border:.3vw solid #8b0000;
        background:#ff0008; color:white;
        cursor:pointer;">ë‹¤ì‹œ ì‹œì‘</button>
    </div>
  `);

  document.getElementById("deathRestart").onclick = ()=>{
    const loseSound=document.getElementById("loseSound");
    loseSound.pause(); loseSound.currentTime=0;

    document.getElementById("deathPopup").remove();
    startIconRainGame();
  };
}

/* ============================================================
   ğŸŒ‘ í˜ì´ë“œ
============================================================ */
function fadeToBlack(callback){
  const df=document.getElementById("dimFade");
  df.style.opacity="1";
  setTimeout(()=>{
    callback();
    df.style.opacity="0";
  },900);
}

/* ============================================================
   ğŸš€ ì¸íŠ¸ë¡œ ì‹œì‘
============================================================ */
setTimeout(()=> showSubtitleNoah("ì—¬ê¸´ ì–´ë””ì§€?"),300);
bgm.play().catch(()=>{});
</script>

</body>
</html>















